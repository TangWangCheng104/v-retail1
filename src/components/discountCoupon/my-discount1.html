<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>滚动加载</title>
	<link href="../css/bootstrap.min.css" rel="stylesheet">
	<link href="../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/discount-scroll.css">
	<link rel="stylesheet" href="../css/store-index.css">
	<link rel="stylesheet" href="../css/discount.css">
	<script src="../js/jquery-1.10.2.min.js"></script>
	<script src="../js/iscroll.js"></script>
	<script src="../js/vue.min.js"></script>
	<script src="../js/iscroll.js"></script>
	<script src="../js/vue-scroll.js"></script>
	<style>
		html{
			font-size: 625%;
			background: #f5f5f5;
			width: 100%;
			height: 100%;
		}
		body{
			font-size: 14px;
			width: 100%;
			height: 100%;
		}
	</style>
	<!--<script>
		$(function(){
			var w = new Vue({
				el: "#wrapper",
				data: {
					//表示显示的图标
					static: "",
					lis: [
						{name:
						`<div class="discount-used-wrap" style="display:block;">
					<div class="dicount-kong-line1"></div>
					<div class="has-discount-left">
						<div class="not-get">
							&lt;!&ndash;&lt;!&ndash;这是红色背景&ndash;&gt;&ndash;&gt;
							<img style="display: none" class="discount-not-get" src="../images/discount_no_get1.png" alt="">
							&lt;!&ndash;&lt;!&ndash;这是灰色背景&ndash;&gt;&ndash;&gt;
							<img style="display: block" class="discount-not-get" src="../images/discount_already_pass1.png" alt="">
                                    <span class="discount-money-wrap">
                                        <span class="discount-money">￥</span>
                                        <span class="discount-price">900</span>
                                    </span>
							<span class="full-money-reduce">满100000可减</span>
						</div>
						<div class="has-discount-right">
							&lt;!&ndash;&lt;!&ndash;这是满减券的指定商品可用&ndash;&gt;&ndash;&gt;
							<div class="discount-name" style="display: none"><span class="full-reduce">满减券</span><span class="use-range">指定商品可用</span></div>
							&lt;!&ndash;&lt;!&ndash;这是慢减券的全部商品可用&ndash;&gt;&ndash;&gt;
							<div class="discount-name" style="display: block"><span class="full-reduce">满减券</span><span class="use-range">指定商品可用</span></div>
							&lt;!&ndash;&lt;!&ndash;这里是时间&ndash;&gt;&ndash;&gt;
							<div class="discount-effect discount-effect-position">
								<span>2017.9.30</span><span class="discount-time-min">15:21</span>至<span>2017.7.30</span><span class="discount-time-min">17:31</span>
								&lt;!&ndash;&lt;!&ndash;这里是小箭头&ndash;&gt;&ndash;&gt;
								<img class="discount-right discount-right-position" src="../images/discount_right.png" alt="">
							</div>
							&lt;!&ndash; &lt;!&ndash;这个是已使用，已过期那些的背景图&ndash;&gt;&ndash;&gt;
							&lt;!&ndash;&lt;!&ndash;已使用&ndash;&gt;&ndash;&gt;
							<img style="display: none" class="already-pass already-use-list" src="../images/already_use.png" alt="">
							&lt;!&ndash;&lt;!&ndash;已经过期&ndash;&gt;&ndash;&gt;
							<img style="display: block" class="already-pass already-use-list" src="../images/already_pass2.png" alt="">
							&lt;!&ndash;&lt;!&ndash;这是商品条图片&ndash;&gt;&ndash;&gt;
							<div class="check-discount-wrap">
								<a class="check-discount" href="javascript:;"><img class="shape-code" src="../images/shape_code.png" alt=""></a>
							</div>
							&lt;!&ndash;&lt;!&ndash;这是快到期&ndash;&gt;&ndash;&gt;
							<img style="display: none" class="already-pass no-effective" src="../images/arrive_time_su.png" alt="">
							&lt;!&ndash;&lt;!&ndash;这是未生效&ndash;&gt;&ndash;&gt;
							<img style="display: block" class="already-pass no-effective" src="../images/no_effective.png" alt="">
						</div>
					</div>
					&lt;!&ndash;&lt;!&ndash;这是有人赠送和放大编号，转赠好友，立即使用的部分&ndash;&gt;&ndash;&gt;
					<div class="mystery-friend-send-wrap discount-name-header">
						<div class="discount-top-send-right discount-sb-name">
							<div class="discount-languges discount-send-name-wrap">
                                        <span>
                                            <span>
                                                <img class="discount-top-img discount-sb-send" src="../images/retail-goodsDetails-img004.png" />
                                                <span class="discount-send-name">浪子书浪子书</span><span class="discount-send-text">赠送</span>
                                            </span>
                                        </span>
                                        <span class="discount-bigger-right">
                                            <span class="discount-bigger" onclick="bigger()">放大编号</span>
                                            <span class="discount-bigger">转赠好友</span>
                                            <span class="discount-bigger">立即使用</span>
                                        </span>
							</div>
						</div>
					</div>
				</div>`
						},
						{name:"二"},
						{name:"三"},
						{name:"四"},
						{name:"五"},
						{name:"六"},
						{name:"七"},
						{name:"八"},
						{name:"九"},
						{name:"十"}
					]
				}
			})
		})

	</script>-->
</head>
<body>
<ul class="store-tap" id="store-tap">
    <li><a href="javascript:;">未使用(<span>3</span>)</a></li>
    <li><a href="javascript:;" class="store-avtive">使用记录(<span>3</span>)</a></li>
    <li><a href="javascript:;">已过期(<span>3</span>)</a></li>
</ul>
	<!--<h1 style="text-align: center">滚动加载</h1>-->
	<div id="wrapper" v-cloak>
		<ul>
			<img class="loading" src="../images/loading.svg" v-if="static == 1">
			<img class="success" src="../images/success.svg" v-if="static == 2">
			<img class="before" src="../images/before.svg" v-if="static == 0">
			<li v-for="li in lis" v-html="li.name">
				{{li.name}}
			</li>
		</ul>
	</div>
	<script src="../js/vue-scroll.js"></script>
	<script>
	var myscroll;
	//是否正在加载中	true表示正在加载  false表示没有加载
	var is_r = false;
	/*获取最后一个li到顶部的距离*/

	$(function(){
		var lastLiTop = $('#wrapper').height();
		var screenInnerHeight = window.innerHeight;
		console.log(lastLiTop);
		console.log(window.innerHeight);
		setTimeout(function(){
			myscroll = new iScroll("wrapper",{
				topOffset: 0,
				//上拉时触发
				onScrollMove: function(){
					w.static = 0;
					//如果上拉高度 大于 (内容高度 - wrapper高度) 50px 以上  且是未刷新状态时触发 ;
					if(this.y <= ( this.wrapperH - this.scroller.clientHeight -50) && is_r == false){
						//正在加载状态
						is_r = true;
						setTimeout(function(){
							//这里表示数据加载成功后
							for (var i = 0;i<3;i++){
								w.lis.push({name: `<div class="discount-used-wrap" style="display:block;">
										<div class="dicount-kong-line1"></div>
										<div class="has-discount-left">
											<div class="not-get">
												<!--&lt;!&ndash;这是红色背景&ndash;&gt;-->
												<img style="display: none" class="discount-not-get" src="../images/discount_no_get1.png" alt="">
												<!--&lt;!&ndash;这是灰色背景&ndash;&gt;-->
												<img style="display: block" class="discount-not-get" src="../images/discount_already_pass1.png" alt="">
														<span class="discount-money-wrap">
															<span class="discount-money">￥</span>
															<span class="discount-price">900</span>
														</span>
												<span class="full-money-reduce">满100000可减</span>
											</div>
											<div class="has-discount-right">
												<!--&lt;!&ndash;这是满减券的指定商品可用&ndash;&gt;-->
												<div class="discount-name" style="display: none"><span class="full-reduce">满减券</span><span class="use-range">指定商品可用</span></div>
												<!--&lt;!&ndash;这是慢减券的全部商品可用&ndash;&gt;-->
												<div class="discount-name" style="display: block"><span class="full-reduce">满减券</span><span class="use-range">指定商品可用</span></div>
												<!--&lt;!&ndash;这里是时间&ndash;&gt;-->
												<div class="discount-effect discount-effect-position">
													<span>2017.9.30</span><span class="discount-time-min">15:21</span>至<span>2017.7.30</span><span class="discount-time-min">17:31</span>
													<!--&lt;!&ndash;这里是小箭头&ndash;&gt;-->
													<img class="discount-right discount-right-position" src="../images/discount_right.png" alt="">
												</div>
												<!-- &lt;!&ndash;这个是已使用，已过期那些的背景图&ndash;&gt;-->
												<!--&lt;!&ndash;已使用&ndash;&gt;-->
												<img style="display: none" class="already-pass already-use-list" src="../images/already_use.png" alt="">
												<!--&lt;!&ndash;已经过期&ndash;&gt;-->
												<img style="display: block" class="already-pass already-use-list" src="../images/already_pass2.png" alt="">
												<!--&lt;!&ndash;这是商品条图片&ndash;&gt;-->
												<div class="check-discount-wrap">
													<a class="check-discount" href="javascript:;"><img class="shape-code" src="../images/shape_code.png" alt=""></a>
												</div>
												<!--&lt;!&ndash;这是快到期&ndash;&gt;-->
												<img style="display: none" class="already-pass no-effective" src="../images/arrive_time_su.png" alt="">
												<!--&lt;!&ndash;这是未生效&ndash;&gt;-->
												<img style="display: block" class="already-pass no-effective" src="../images/no_effective.png" alt="">
											</div>
										</div>
										<!--&lt;!&ndash;这是有人赠送和放大编号，转赠好友，立即使用的部分&ndash;&gt;-->
										<div class="mystery-friend-send-wrap discount-name-header">
											<div class="discount-top-send-right discount-sb-name">
												<div class="discount-languges discount-send-name-wrap">
													<span>
														<span>
															<img class="discount-top-img discount-sb-send" src="../images/retail-goodsDetails-img004.png" />
															<span class="discount-send-name">浪子书浪子书</span><span class="discount-send-text">赠送</span>
														</span>
													</span>
													<span class="discount-bigger-right">
														<span class="discount-bigger" onclick="bigger()">放大编号</span>
														<span class="discount-bigger">转赠好友</span>
														<span class="discount-bigger">立即使用</span>
													</span>
												</div>
											</div>
										</div>
									</div>`});
							}
							//这里表示渲染完成后刷新wrapper
							setTimeout(function(){
								console.log("刷新wrapper");
								//显示加载成功状态图标 (没有更多数据时候的提示作用)
								w.static = 2;
								console.log(w.static);
								var ulHeight = $("#wrapper").css("height")
								/*if(ulHeight > screenInnerHeight){
									$("#wrapper").css("height",screenInnerHeight)
								}else{
									$("#wrapper").css("height",ulHeight)
								}*/
								setTimeout(function(){
									w.static = "";
								},500)
								//加载完成状态
								is_r = false;
								myscroll.refresh();
							},0)
						},2000)

					}
				},
				onScrollEnd: function(){
					//上拉之后如果触发刷新则 状态图标值为1 显示loading状态
					if(is_r == true){
						w.static = 1;
					}
				}
			});
		},0);
	})

	</script>
</body>
</html>