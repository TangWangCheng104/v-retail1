/*! wangeditor.js 2016-05-02 */
;!function(b){"function"==typeof window.define?window.define.amd?window.define("wangEditor",["jquery"],b):window.define.cmd?window.define(function(a,f,e){return b}):b(window.jQuery):"object"==typeof module&&"object"==typeof module.exports?module.exports=b(require("./wangEditor-jquery.js")):b(window.jQuery)}(function(d){if(!d||!d.fn||!d.fn.jquery){return void alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor")}var c=function(a){var e=window.wangEditor;e&&a(e,d)};return function(f,e){if(f.wangEditor){return void alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！")}var g=function(b){"string"==typeof b&&(b="#"+b);var i=e(b);if(1===i.length){var h=i[0].nodeName;("TEXTAREA"===h||"DIV"===h)&&(this.valueNodeName=h.toLowerCase(),this.$valueContainer=i,this.$prev=i.prev(),this.$parent=i.parent(),this.init())}};g.fn=g.prototype,g.$body=e("body"),g.$document=e(document),g.$window=e(f),g.userAgent=navigator.userAgent,g.getComputedStyle=f.getComputedStyle,g.w3cRange="function"==typeof document.createRange,g.hostname=location.hostname.toLowerCase(),g.websiteHost="wangeditor.github.io",g.isOnWebsite=g.hostname===g.websiteHost,g.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961",f.wangEditor=g,g.plugin=function(b){g._plugins||(g._plugins=[]),"function"==typeof b&&g._plugins.push(b)}}(window,d),c(function(f,e){f.fn.init=function(){this.initDefaultConfig(),this.addEditorContainer(),this.addTxt(),this.addMenuContainer(),this.menus={},this.commandHooks()}}),c(function(f,e){f.fn.ready=function(b){this.readyFns||(this.readyFns=[]),this.readyFns.push(b)},f.fn.readyHeadler=function(){for(var b=this.readyFns;b.length;){b.shift().call(this)}},f.fn.updateValue=function(){var h=this,g=h.$valueContainer,j=h.txt.$txt;if(g!==j){var i=j.html();g.val(i)}},f.fn.getInitValue=function(){var h=this,g=h.$valueContainer,j="",i=h.valueNodeName;return"div"===i?j=g.html():"textarea"===i&&(j=g.val()),j},f.fn.updateMenuStyle=function(){var b=this.menus;e.each(b,function(h,g){g.updateSelected()})},f.fn.enableMenusExcept=function(b){this._disabled||(b=b||[],"string"==typeof b&&(b=[b]),e.each(this.menus,function(a,g){b.indexOf(a)>=0||g.disabled(!1)}))},f.fn.disableMenusExcept=function(b){this._disabled||(b=b||[],"string"==typeof b&&(b=[b]),e.each(this.menus,function(a,g){b.indexOf(a)>=0||g.disabled(!0)}))},f.fn.hideDropPanelAndModal=function(){var b=this.menus;e.each(b,function(h,g){var i=g.dropPanel||g.dropList||g.modal;i&&i.hide&&i.hide()})}}),c(function(f,e){function h(){}var g=!f.w3cRange;f.fn.currentRange=function(b){return b?void (this._rangeData=b):this._rangeData},f.fn.collapseRange=function(j,i){i=i||"end",i="start"===i?!0:!1,j=j||this.currentRange(),j&&(j.collapse(i),this.currentRange(j))},f.fn.getRangeText=g?h:function(b){return(b=b||this.currentRange())?b.toString():void 0},f.fn.getRangeElem=g?h:function(j){j=j||this.currentRange();var i=j.commonAncestorContainer;return 1===i.nodeType?i:i.parentNode},f.fn.isRangeEmpty=g?h:function(b){return b=b||this.currentRange(),b&&b.startContainer&&b.startContainer===b.endContainer&&b.startOffset===b.endOffset?!0:!1},f.fn.saveSelection=g?h:function(b){var l,k,j=this,i=j.txt.$txt.get(0);b?l=b.commonAncestorContainer:(k=document.getSelection(),k.getRangeAt&&k.rangeCount&&(b=document.getSelection().getRangeAt(0),l=b.commonAncestorContainer)),l&&(e.contains(i,l)||i===l)&&j.currentRange(b)},f.fn.restoreSelection=g?h:function(a){var j;if(a=a||this.currentRange()){try{j=document.getSelection(),j.removeAllRanges(),j.addRange(a)}catch(i){f.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}}},f.fn.restoreSelectionByElem=g?h:function(j,i){j&&(i=i||"end",this.setRangeByElem(j),"start"===i&&this.collapseRange(this.currentRange(),"start"),"end"===i&&this.collapseRange(this.currentRange(),"end"),this.restoreSelection())},f.fn.initSelection=g?h:function(){var j=this;if(!j.currentRange()){var i=j.txt.$txt,k=i.children().first();k.length&&j.restoreSelectionByElem(k.get(0))}},f.fn.setRangeByElem=g?h:function(b){var m=this,l=m.txt.$txt.get(0);if(b&&e.contains(l,b)){for(var k=b.firstChild;k&&3!==k.nodeType;){k=k.firstChild}for(var j=b.lastChild;j&&3!==j.nodeType;){j=j.lastChild}var i=document.createRange();k&&j?(i.setStart(k,0),i.setEnd(j,j.textContent.length)):(i.setStart(b,0),i.setEnd(b,0)),m.saveSelection(i)}}}),c(function(f,e){f.w3cRange||(f.fn.getRangeText=function(b){return(b=b||this.currentRange())?b.text:void 0},f.fn.getRangeElem=function(h){if(h=h||this.currentRange()){var g=h.parentElement();return 1===g.nodeType?g:g.parentNode}},f.fn.isRangeEmpty=function(b){return b=b||this.currentRange(),b&&b.text?!1:!0},f.fn.saveSelection=function(b){var i,h=this,g=h.txt.$txt.get(0);b?i=b.parentElement():(b=document.selection.createRange(),i="undefined"==typeof b.parentElement?null:b.parentElement()),i&&(e.contains(g,i)||g===i)&&h.currentRange(b)},f.fn.restoreSelection=function(h){var g,j=this;if(h=h||j.currentRange()){g=document.selection.createRange();try{g.setEndPoint("EndToEnd",h)}catch(i){}if(0===h.text.length){try{g.collapse(!1)}catch(i){}}else{g.setEndPoint("StartToStart",h)}g.select()}})}),c(function(f,e){f.fn.commandHooks=function(){var b=this,g={};g.insertHtml=function(j){var i,h=e(j),a=b.getRangeElem();i=b.getLegalTags(a),i&&e(i).after(h)},b.commandHooks=g}}),c(function(f,e){f.fn.command=function(i,h,n,m){function l(){h&&(j.queryCommandSupported(h)?document.execCommand(h,!1,n):(k=j.commandHooks,h in k&&k[h](n)))}var k,j=this;this.customCommand(i,l,m)},f.fn.commandForElem=function(j,i,p,o,n){var m,l;"string"==typeof j?m=j:(m=j.selector,l=j.check);var k=this.getRangeElem();k=this.getSelfOrParentByName(k,m,l),k&&this.setRangeByElem(k),this.command(i,p,o,n)},f.fn.customCommand=function(h,g,l){function k(){j.hideDropPanelAndModal()}var j=this,i=j.currentRange();return i?(j.undoRecord(),this.restoreSelection(i),g.call(j),this.saveSelection(),this.restoreSelection(),l&&"function"==typeof l&&l.call(j),j.txt.insertEmptyP(),j.txt.wrapImgAndText(),j.updateValue(),j.updateMenuStyle(),setTimeout(k,200),void (h&&h.preventDefault())):void (h&&h.preventDefault())},f.fn.queryCommandValue=function(h){var g="";try{g=document.queryCommandValue(h)}catch(i){}return g},f.fn.queryCommandState=function(h){var g=!1;try{g=document.queryCommandState(h)}catch(i){}return g},f.fn.queryCommandSupported=function(h){var g=!1;try{g=document.queryCommandSupported(h)}catch(i){}return g}}),c(function(f,e){function h(b){var k=this,j=e(b),i=!1;return j.each(function(){return this===k?(i=!0,!1):void 0}),i}var g;f.fn.getLegalTags=function(a){var i=this.config.legalTags;return i?this.getSelfOrParentByName(a,i):void f.error("配置项中缺少 legalTags 的配置")},f.fn.getSelfOrParentByName=function(b,k,j){if(b&&k){g||(g=b.webkitMatchesSelector||b.mozMatchesSelector||b.oMatchesSelector||b.matchesSelector),g||(g=h);for(var i=this.txt.$txt.get(0);b&&i!==b&&e.contains(i,b);){if(g.call(b,k)){if(!j){return b}if(j(b)){return b}}b=b.parentNode}}}}),c(function(h,g){function l(m,f,p){var o=f.val,n=m.txt.$txt.html();if(null!=o){if(o===n){return"redo"===p?void m.redo():"undo"===p?void m.undo():void 0}m.txt.$txt.html(o),m.updateValue(),m.onchange&&"function"==typeof m.onchange&&m.onchange.call(m)}}var k=[],j=[],i=20;h.fn.undoRecord=function(){var f=this,e=f.txt.$txt,n=e.html(),m=j.length?j[0]:"";n!==m.val&&(k.length&&(k=[]),j.unshift({range:f.currentRange(),val:n}),j.length>i&&j.pop())},h.fn.undo=function(){if(j.length){var b=j.shift();k.unshift(b),l(this,b,"undo")}},h.fn.redo=function(){if(k.length){var b=k.shift();j.unshift(b),l(this,b,"redo")}}}),c(function(f,e){f.fn.create=function(){var b=this;f.$body&&0!==f.$body.length||(f.$body=e("body"),f.$document=e(document),f.$window=e(window)),b.addMenus(),b.renderMenus(),b.renderMenuContainer(),b.renderTxt(),b.renderEditorContainer(),b.eventMenus(),b.eventMenuContainer(),b.eventTxt(),b.readyHeadler(),b.initSelection(),b.$txt=b.txt.$txt;var a=f._plugins;a&&a.length&&e.each(a,function(h,g){g.call(b)})},f.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable"),this.disableMenusExcept(),this._disabled=!0},f.fn.enable=function(){this._disabled=!1,this.txt.$txt.attr("contenteditable","true"),this.enableMenusExcept()},f.fn.destroy=function(){var h=this,g=h.$valueContainer,j=h.$editorContainer,i=h.valueNodeName;"div"===i?(g.removeAttr("contenteditable"),j.after(g),j.hide()):(g.show(),j.hide())},f.fn.undestroy=function(){var h=this,g=h.$valueContainer,k=h.$editorContainer,j=h.menuContainer.$menuContainer,i=h.valueNodeName;"div"===i?(g.attr("contenteditable","true"),j.after(g),k.show()):(g.hide(),k.show())},f.fn.clear=function(){var h=this,g=h.txt.$txt;g.html("<p><br></p>"),h.restoreSelectionByElem(g.find("p").get(0))}}),c(function(f,e){var g=function(b){this.editor=b,this.init()};g.fn=g.prototype,f.MenuContainer=g}),c(function(f,e){var g=f.MenuContainer;g.fn.init=function(){var b=this,h=e('<div class="wangEditor-menu-container clearfix"></div>');b.$menuContainer=h,b.changeShadow()},g.fn.changeShadow=function(){var i=this.$menuContainer,h=this.editor,j=h.txt.$txt;j.on("scroll",function(){j.scrollTop()>10?i.addClass("wangEditor-menu-shadow"):i.removeClass("wangEditor-menu-shadow")})}}),c(function(f,e){var g=f.MenuContainer;g.fn.render=function(){var i=this.$menuContainer,h=this.editor.$editorContainer;h.append(i)},g.fn.height=function(){var b=this.$menuContainer;return b.height()},g.fn.appendMenu=function(i,h){return this._addGroup(i),this._addOneMenu(h)},g.fn._addGroup=function(b){var i,h=this.$menuContainer;this.$currentGroup&&this.currentGroupIdx===b||(i=e('<div class="menu-group clearfix"></div>'),h.append(i),this.$currentGroup=i,this.currentGroupIdx=b)},g.fn._addOneMenu=function(b){var k=b.$domNormal,j=b.$domSelected,i=this.$currentGroup,h=e('<div class="menu-item clearfix"></div>');return j.hide(),h.append(k).append(j),i.append(h),h}}),c(function(f,e){var g=function(b){this.editor=b.editor,this.id=b.id,this.title=b.title,this.$domNormal=b.$domNormal,this.$domSelected=b.$domSelected||b.$domNormal,this.commandName=b.commandName,this.commandValue=b.commandValue,this.commandNameSelected=b.commandNameSelected||b.commandName,this.commandValueSelected=b.commandValueSelected||b.commandValue};g.fn=g.prototype,f.Menu=g}),c(function(f,e){var g=f.Menu;g.fn.initUI=function(){var i=this.editor,h=i.UI.menus,b=this.id,a=h[b];this.$domNormal&&this.$domSelected||(null==a&&(f.warn('editor.UI配置中，没有菜单 "'+b+'" 的UI配置，只能取默认值'),a=h["default"]),this.$domNormal=e(a.normal),/^\./.test(a.selected)?this.$domSelected=this.$domNormal.clone().addClass(a.selected.slice(1)):this.$domSelected=e(a.selected))}}),c(function(f,e){var g=f.Menu;g.fn.render=function(i){this.initUI();var h=this.editor,l=h.menuContainer,k=l.appendMenu(i,this),j=this.onRender;this._renderTip(k),j&&"function"==typeof j&&j.call(this)},g.fn._renderTip=function(r){function q(){b.show()}function p(){b.hide()}var o,n=this,m=n.editor,l=n.title,b=e('<div class="menu-tip"></div>');n.tipWidth||(o=e('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+l+"</p>"),f.$body.append(o),m.ready(function(){var i=o.outerWidth()+5,h=b.outerWidth(),j=parseFloat(b.css("margin-left"),10);o.remove(),o=null,b.css({width:i,"margin-left":j+(h-i)/2}),n.tipWidth=i})),b.append(l),r.append(b);var a;r.find("a").on("mouseenter",function(h){n.active()||n.disabled()||(a=setTimeout(q,200))}).on("mouseleave",function(h){a&&clearTimeout(a),p()}).on("click",p)},g.fn.bindEvent=function(){var a=this,k=a.$domNormal,j=a.$domSelected,i=a.clickEvent;i||(i=function(p){var o=a.dropPanel||a.dropList||a.modal;if(o&&o.show){return void (o.isShowing?o.hide():o.show())}var n,m,l=a.editor,b=a.selected;b?(n=a.commandNameSelected,m=a.commandValueSelected):(n=a.commandName,m=a.commandValue),n?l.command(p,n,m):(f.warn('菜单 "'+a.id+'" 未定义click事件'),p.preventDefault())});var h=a.clickEventSelected||i;k.click(function(b){a.disabled()||(i.call(a,b),a.updateSelected()),b.preventDefault()}),j.click(function(b){a.disabled()||(h.call(a,b),a.updateSelected()),b.preventDefault()})},g.fn.updateSelected=function(){var i=this,h=(i.editor,i.updateSelectedEvent);h||(h=function(){var l=this,k=l.editor,n=l.commandName,m=l.commandValue;if(m){if(k.queryCommandValue(n).toLowerCase()===m.toLowerCase()){return !0}}else{if(k.queryCommandState(n)){return !0}}return !1});var j=h.call(i);j=!!j,i.changeSelectedState(j)},g.fn.changeSelectedState=function(i){var h=this,j=h.selected;if(null!=i&&"boolean"==typeof i){if(j===i){return}h.selected=i,i?(h.$domNormal.hide(),h.$domSelected.show()):(h.$domNormal.show(),h.$domSelected.hide())}},g.fn.active=function(b){return null==b?this._activeState:void (this._activeState=b)},g.fn.activeStyle=function(i){var h=(this.selected,this.$domNormal),j=this.$domSelected;i?(h.addClass("active"),j.addClass("active")):(h.removeClass("active"),j.removeClass("active")),this.active(i)},g.fn.disabled=function(i){if(null==i){return !!this._disabled}if(this._disabled!==i){var h=this.$domNormal,j=this.$domSelected;i?(h.addClass("disable"),j.addClass("disable")):(h.removeClass("disable"),j.removeClass("disable")),this._disabled=i}}}),c(function(f,e){var g=function(i,h,j){this.editor=i,this.menu=h,this.data=j.data,this.tpl=j.tpl,this.selectorForELemCommand=j.selectorForELemCommand,this.beforeEvent=j.beforeEvent,this.afterEvent=j.afterEvent,this.init()};g.fn=g.prototype,f.DropList=g}),c(function(f,e){var g=f.DropList;g.fn.init=function(){var b=this;b.initDOM(),b.bindEvent(),b.initHideEvent()},g.fn.initDOM=function(){var b,l,k=this,j=k.data,i=k.tpl||"<span>{#title}</span>",h=e('<div class="wangEditor-drop-list clearfix"></div>');e.each(j,function(m,a){b=i.replace(/{#commandValue}/gi,m).replace(/{#title}/gi,a),l=e('<a href="#" commandValue="'+m+'"></a>'),l.append(b),h.append(l)}),k.$list=h},g.fn.bindEvent=function(){var b=this,p=b.editor,o=b.menu,n=o.commandName,m=b.selectorForELemCommand,l=b.$list,k=b.beforeEvent,j=b.afterEvent;l.on("click","a[commandValue]",function(h){k&&"function"==typeof k&&k.call(h);var i=e(h.currentTarget).attr("commandValue");o.selected&&p.isRangeEmpty()&&m?p.commandForElem(m,h,n,i):p.command(h,n,i),j&&"function"==typeof j&&j.call(h)})},g.fn.initHideEvent=function(){var b=this,a=b.$list.get(0);f.$body.on("click",function(h){if(b.isShowing){var k,j=h.target,i=b.menu;k=i.selected?i.$domSelected.get(0):i.$domNormal.get(0),k===j||e.contains(k,j)||a===j||e.contains(a,j)||b.hide()}}),f.$window.scroll(function(){b.hide()}),f.$window.on("resize",function(){b.hide()})}}),c(function(f,e){var g=f.DropList;g.fn._render=function(){var i=this,h=i.editor,j=i.$list;h.$editorContainer.append(j),i.rendered=!0},g.fn._position=function(){var H=this,G=H.$list,F=H.editor,E=H.menu,D=F.menuContainer.$menuContainer,C=E.selected?E.$domSelected:E.$domNormal,B=C.offsetParent().position(),A=B.top,z=B.left,y=C.offsetParent().height(),x=C.offsetParent().width(),w=G.outerWidth(),v=F.txt.$txt.outerWidth(),u=A+y,t=z+x/2,s=0-x/2,r=t+w-v;r>-10&&(s=s-r-10),G.css({top:u,left:t,"margin-left":s}),F._isMenufixed&&(u+=D.offset().top+D.outerHeight()-G.offset().top,G.css({top:u}))},g.fn.show=function(){var i=this,h=i.menu;if(i.rendered||i._render(),!i.isShowing){var j=i.$list;j.show(),i._position(),i.isShowing=!0,h.activeStyle(!0)}},g.fn.hide=function(){var i=this,h=i.menu;if(i.isShowing){var j=i.$list;j.hide(),i.isShowing=!1,h.activeStyle(!1)}}}),c(function(f,e){var g=function(i,h,j){this.editor=i,this.menu=h,this.$content=j.$content,this.width=j.width||200,this.height=j.height,this.onRender=j.onRender,this.init()};g.fn=g.prototype,f.DropPanel=g}),c(function(f,e){var g=f.DropPanel;g.fn.init=function(){var b=this;b.initDOM(),b.initHideEvent()},g.fn.initDOM=function(){var b=this,l=b.$content,k=b.width,j=b.height,i=e('<div class="wangEditor-drop-panel clearfix"></div>'),h=e('<div class="tip-triangle"></div>');i.css({width:k,height:j?j:"auto"}),i.append(h),i.append(l),b.$panel=i,b.$triangle=h},g.fn.initHideEvent=function(){var b=this,a=b.$panel.get(0);f.$body.on("click",function(h){if(b.isShowing){var k,j=h.target,i=b.menu;k=i.selected?i.$domSelected.get(0):i.$domNormal.get(0),k===j||e.contains(k,j)||a===j||e.contains(a,j)||b.hide()}}),f.$window.scroll(function(){b.hide()}),f.$window.on("resize",function(){b.hide()})}}),c(function(f,e){var g=f.DropPanel;g.fn._render=function(){var i=this,h=i.onRender,k=i.editor,j=i.$panel;k.$editorContainer.append(j),h&&h.call(i),i.rendered=!0},g.fn._position=function(){var L=this,K=L.$panel,J=L.$triangle,I=L.editor,H=I.menuContainer.$menuContainer,G=L.menu,F=G.selected?G.$domSelected:G.$domNormal,E=F.offsetParent().position(),D=E.top,C=E.left,B=F.offsetParent().height(),A=F.offsetParent().width(),z=K.outerWidth(),y=I.txt.$txt.outerWidth(),x=D+B,w=C+A/2,v=0-z/2,u=v;0-v>w-10&&(v=0-(w-10));var t=w+z+v-y;t>-10&&(v=v-t-10),K.css({top:x,left:w,"margin-left":v}),I._isMenufixed&&(x+=H.offset().top+H.outerHeight()-K.offset().top,K.css({top:x})),J.css({"margin-left":u-v-5})},g.fn.focusFirstInput=function(){var b=this,h=b.$panel;h.find("input[type=text],textarea").each(function(){var i=e(this);return null==i.attr("disabled")?(i.focus(),!1):void 0})},g.fn.show=function(){var a=this,i=a.menu;if(a.rendered||a._render(),!a.isShowing){var h=a.$panel;h.show(),a._position(),a.isShowing=!0,i.activeStyle(!0),f.w3cRange?a.focusFirstInput():f.placeholderForIE8(h)}},g.fn.hide=function(){var i=this,h=i.menu;if(i.isShowing){var j=i.$panel;j.hide(),i.isShowing=!1,h.activeStyle(!1)}}}),c(function(f,e){var g=function(i,h,j){this.editor=i,this.menu=h,this.$content=j.$content,this.init()};g.fn=g.prototype,f.Modal=g}),c(function(f,e){var g=f.Modal;g.fn.init=function(){var b=this;b.initDom(),b.initHideEvent()},g.fn.initDom=function(){var b=this,j=b.$content,i=e('<div class="wangEditor-modal"></div>'),h=e('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');i.append(h),i.append(j),b.$modal=i,b.$close=h},g.fn.initHideEvent=function(){var h=this,b=h.$close,a=h.$modal.get(0);b.click(function(){h.hide()}),f.$body.on("click",function(i){if(h.isShowing){var l,k=i.target,j=h.menu;j&&(l=j.selected?j.$domSelected.get(0):j.$domNormal.get(0),l===k||e.contains(l,k))||a===k||e.contains(a,k)||h.hide()}})}}),c(function(f,e){var g=f.Modal;g.fn._render=function(){var a=this,i=a.editor,h=a.$modal;h.css("z-index",i.config.zindex+10+""),f.$body.append(h),a.rendered=!0},g.fn._position=function(){var a=this,p=a.$modal,o=p.offset().top,n=p.outerWidth(),m=p.outerHeight(),l=0-n/2,k=0-m/2,j=f.$window.scrollTop();m/2>o&&(k=0-o),p.css({"margin-left":l+"px","margin-top":k+j+"px"})},g.fn.show=function(){var i=this,h=i.menu;if(i.rendered||i._render(),!i.isShowing){i.isShowing=!0;var j=i.$modal;j.show(),i._position(),h&&h.activeStyle(!0)}},g.fn.hide=function(){var i=this,h=i.menu;if(i.isShowing){i.isShowing=!1;var j=i.$modal;j.hide(),h&&h.activeStyle(!1)}}}),c(function(f,e){var g=function(b){this.editor=b,this.init()};g.fn=g.prototype,f.Txt=g}),c(function(f,e){var g=f.Txt;g.fn.init=function(){var b,k=this,j=k.editor,i=j.$valueContainer,h=j.getInitValue();"DIV"===i.get(0).nodeName?(b=i,b.addClass("wangEditor-txt"),b.attr("contentEditable","true")):b=e('<div class="wangEditor-txt" contentEditable="true">'+h+"</div>"),j.ready(function(){k.insertEmptyP()}),k.$txt=b,k.contentEmptyHandle(),k.bindEnterForDiv(),k.bindEnterForText(),k.bindTabEvent(),k.bindPasteFilter(),k.bindFormatText(),k.bindHtml()},g.fn.contentEmptyHandle=function(){var b,j=this,i=j.editor,h=j.$txt;h.on("keydown",function(k){if(8===k.keyCode){var l=e.trim(h.html().toLowerCase());return"<p><br></p>"===l?void k.preventDefault():void 0}}),h.on("keyup",function(k){if(8===k.keyCode){var a=e.trim(h.html().toLowerCase());a&&"<br>"!==a||(b=e("<p><br/></p>"),h.html(""),h.append(b),i.restoreSelectionByElem(b.get(0)))}})},g.fn.bindEnterForDiv=function(){function j(){if(i){var k=e("<p>"+i.html()+"</p>");i.after(k),i.remove()}}var i,h=(f.config.legalTags,this),b=h.editor,a=h.$txt;a.on("keydown keyup",function(k){if(13===k.keyCode){var o,n,m=b.getRangeElem(),l=b.getLegalTags(m);if(!l){if(l=b.getSelfOrParentByName(m,"div"),!l){return}o=e(l),"keydown"===k.type&&(i=o,setTimeout(j,0)),"keyup"===k.type&&(n=e("<p>"+o.html()+"</p>"),o.after(n),o.remove(),b.restoreSelectionByElem(n.get(0),"start"))}}})},g.fn.bindEnterForText=function(){var i,h=this,j=h.$txt;j.on("keyup",function(a){13===a.keyCode&&(i||(i=function(){h.wrapImgAndText()}),setTimeout(i))})},g.fn.bindTabEvent=function(){var i=this,h=i.editor,j=i.$txt;j.on("keydown",function(b){9===b.keyCode&&h.queryCommandSupported("insertHtml")&&h.command(b,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")})},g.fn.bindPasteFilter=function(){function r(t){if(t&&t.nodeType&&t.nodeName){var s,j=t.nodeName.toLowerCase(),a=t.nodeType;if(3===a||1===a){if(s=e(t),"div"===j){return void e.each(t.childNodes,function(){r(this)})}if(b.indexOf(j)>=0){m+=q(t)}else{if(3===a){m+="<p>"+t.textContent+"</p>"}else{if("br"===j){m+="<br/>"}else{if(["meta","style","script","object","form","iframe","hr"].indexOf(j)>=0){return}s=e(p(t)),m+=e("<div>").append(s.clone()).html()}}}}}}function q(h){var t,s=h.nodeName.toLowerCase(),j="",i="";return["blockquote"].indexOf(s)>=0?(t=e(h),"<"+s+">"+t.text()+"</"+s+">"):["p","h1","h2","h3","h4","h5"].indexOf(s)>=0?(h=p(h),t=e(h),j=t.html(),j=j.replace(/<.*?>/gi,function(u){return"</a>"===u||0===u.indexOf("<a ")||0===u.indexOf("<img ")?u:""}),"<"+s+">"+j+"</"+s+">"):["ul","ol"].indexOf(s)>=0?(t=e(h),t.children().each(function(){var u=e(p(this)),v=u.html();v=v.replace(/<.*?>/gi,function(w){return"</a>"===w||0===w.indexOf("<a ")||0===w.indexOf("<img ")?w:""}),i+="<li>"+v+"</li>"}),"<"+s+">"+i+"</"+s+">"):(t=e(p(h)),e("<div>").append(t).html())}function p(h){var t=h.attributes||[],s=[],j=["href","target","src","alt","rowspan","colspan"];e.each(t,function(v,u){u&&2===u.nodeType&&s.push(u.nodeName)}),e.each(s,function(a,u){j.indexOf(u)<0&&h.removeAttribute(u)});var i=h.childNodes;return i.length&&e.each(i,function(v,u){p(u)}),h}var o=this,n=o.editor,m="",l=o.$txt,k=n.config.legalTags,b=k.split(",");l.on("paste",function(v){if(n.config.pasteFilter){var u=n.getRangeElem().nodeName;if("TD"!==u&&"TH"!==u){m="";var t,s,a=v.clipboardData||v.originalEvent.clipboardData;if(a&&a.getData){t=a.getData("text/html"),t?(s=e("<div>"+t+"</div>"),r(s.get(0))):(t=a.getData("text/plain"),t&&(t=t.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>"),m="<p>"+t+"</p>",m=m.replace(/<p>(https?:\/\/.*?)<\/p>/gi,function(i,h){return'<p><a href="'+h+'" target="_blank">'+h+"</p>"})))}else{if(!window.clipboardData||!window.clipboardData.getData){return}if(m=window.clipboardData.getData("text"),!m){return}m="<p>"+m+"</p>",m=m.replace((new RegExp("\n","g"),"</p><p>"))}m&&(n.command(v,"insertHtml",m),o.clearEmptyOrNestP())}}})},g.fn.bindFormatText=function(){var j=this,i=(j.editor,j.$txt),h=f.config.legalTags,b=h.split(","),a=(b.length,[]);e.each(b,function(l,k){var m=">\\s*<("+k+")>";a.push(new RegExp(m,"ig"))}),a.push(new RegExp(">\\s*<(li)>","ig")),a.push(new RegExp(">\\s*<(tr)>","ig")),a.push(new RegExp(">\\s*<(code)>","ig")),i.formatText=function(){var k=e("<div>"),l=i.html();return l=l.replace(/\s*</gi,"<"),e.each(a,function(n,m){m.test(l)&&(l=l.replace(m,function(p,o){return">\n<"+o+">"}))}),k.html(l),k.text()}},g.fn.bindHtml=function(){var b=this,k=b.editor,j=b.$txt,i=k.$valueContainer,h=k.valueNodeName;j.html=function(l){var m;return"div"===h&&(m=e.fn.html.call(j,l)),void 0===l?m=e.fn.html.call(j):(m=e.fn.html.call(j,l),i.val(l)),void 0===l?m:void 0}}}),c(function(f,e){var h=f.Txt,g="propertychange change click keyup input paste";h.fn.render=function(){var j=this.$txt,i=this.editor.$editorContainer;i.append(j)},h.fn.initHeight=function(){var j=this.editor,i=this.$txt,m=j.$valueContainer.height(),l=j.menuContainer.height(),k=m-l;k=50>k?50:k,i.height(k),j.valueContainerHeight=m,this.initMaxHeight(k,l)},h.fn.initMaxHeight=function(n,m){var l=this.editor,k=l.menuContainer.$menuContainer,j=this.$txt,b=e("<div>");if(window.getComputedStyle&&"max-height" in window.getComputedStyle(j.get(0))){var a=parseInt(l.$valueContainer.css("max-height"));if(isNaN(a)){return}if(l.menus.fullscreen){return void f.warn("max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用")}l.useMaxHeight=!0,b.css({"max-height":a-m+"px","overflow-y":"auto"}),j.css({height:"auto","overflow-y":"visible","min-height":n+"px"}),b.on("scroll",function(){j.parent().scrollTop()>10?k.addClass("wangEditor-menu-shadow"):k.removeClass("wangEditor-menu-shadow")}),j.wrap(b)}},h.fn.saveSelectionEvent=function(){function j(){l.saveSelection()}function i(){Date.now()-k<100||(k=Date.now(),j())}function o(){n&&clearTimeout(n),n=setTimeout(j,300)}var n,m=this.$txt,l=this.editor,k=Date.now();m.on(g+" focus blur",function(b){i(),o()}),m.on("mousedown",function(){m.on("mouseleave.saveSelection",function(b){i(),o(),l.updateMenuStyle()})}).on("mouseup",function(){m.off("mouseleave.saveSelection")})},h.fn.updateValueEvent=function(){function j(){var b=l.html();m!==b&&(k.onchange&&"function"==typeof k.onchange&&k.onchange.call(k),k.updateValue(),m=b)}var i,m,l=this.$txt,k=this.editor;l.on(g,function(a){null==m&&(m=l.html()),i&&clearTimeout(i),i=setTimeout(j,100)})},h.fn.updateMenuStyleEvent=function(){var j=this.$txt,i=this.editor;j.on(g,function(b){i.updateMenuStyle()})},h.fn.insertEmptyP=function(){var b=this.$txt,i=b.children();return 0===i.length?void b.append(e("<p><br></p>")):void ("<br>"!==e.trim(i.last().html()).toLowerCase()&&b.append(e("<p><br></p>")))},h.fn.wrapImgAndText=function(){var b,n,m=this.$txt,l=m.children("img"),k=m[0],j=k.childNodes,i=j.length;for(l.length&&l.each(function(){e(this).wrap("<p>")}),b=0;i>b;b++){n=j[b],3===n.nodeType&&n.textContent&&e.trim(n.textContent)&&e(n).wrap("<p>")}},h.fn.clearEmptyOrNestP=function(){var b=this.$txt,i=b.find("p");i.each(function(){var j,n=e(this),m=n.children(),l=m.length,k=e.trim(n.html());return k?void (1===l&&(j=m.first(),j.get(0)&&"P"===j.get(0).nodeName&&n.html(j.html()))):void n.remove()})},h.fn.scrollTop=function(j){var i=this,l=i.editor,k=i.$txt;return l.useMaxHeight?k.parent().scrollTop(j):k.scrollTop(j)},h.fn.showHeightOnHover=function(){function b(r){j||(n.append(k),j=!0);var i=(l.position().top,l.outerHeight(),r.height()),v=r.position().top,u=parseInt(r.css("margin-top"),10),t=parseInt(r.css("padding-top"),10),s=parseInt(r.css("margin-bottom"),10),q=parseInt(r.css("padding-bottom"),10);v+m.height();k.css({height:i+t+u+q+s,top:v+m.height()})}function p(){j&&(k.remove(),j=!1)}var o=this.editor,n=o.$editorContainer,m=o.menuContainer,l=this.$txt,k=e('<i class="height-tip"><i>'),j=!1;l.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(a){b(e(a.currentTarget))}).on("mouseleave",function(){p()})}}),c(function(f,e){Array.prototype.indexOf||(Array.prototype.indexOf=function(j){for(var i=0,k=this.length;k>i;i++){if(this[i]===j){return i}}return -1},Array.prototype.lastIndexOf=function(j){var i=this.length;for(i-=1;i>=0;i--){if(this[i]===j){return i}}return -1}),Date.now||(Date.now=function(){return(new Date).valueOf()});var h=window.console,g=function(){};e.each(["info","log","warn","error"],function(a,i){null==h?f[i]=g:f[i]=function(j){f.config&&f.config.printLog&&h[i]("wangEditor提示: "+j)}}),f.random=function(){return Math.random().toString().slice(2)},f.placeholder="placeholder" in document.createElement("input"),f.placeholderForIE8=function(a){f.placeholder||a.find("input[placeholder]").each(function(){var b=e(this),i=b.attr("placeholder");""===b.val()&&(b.css("color","#666"),b.val(i),b.on("focus.placeholder click.placeholder",function(){b.val(""),b.css("color","#333"),b.off("focus.placeholder click.placeholder")}))})}}),c(function(f,e){f.langs={},f.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"},f.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}}),c(function(f,e){f.config={},f.config.zindex=10000,f.config.printLog=!0,f.config.menuFixed=0,f.config.jsFilter=!0,f.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre",f.config.lang=f.langs["zh-cn"],f.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"],f.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"},f.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS"],f.config.fontsizes={1:"10px",2:"13px",3:"16px",4:"19px",5:"22px",6:"25px",7:"28px"},f.config.emotionsShow="icon",f.config.emotions={"default":{title:"默认",data:"./emotions.data"},weibo:{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}},f.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas",f.config.uploadImgUrl="",f.config.uploadTimeout=20000,f.config.uploadImgFns={},f.config.customUpload=!1,f.config.uploadParams={},f.config.pasteFilter=!0}),c(function(f,e){f.UI={},f.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}}),c(function(f,e){f.fn.initDefaultConfig=function(){var a=this;a.config=e.extend({},f.config),a.UI=e.extend({},f.UI)}}),c(function(f,e){f.fn.addEditorContainer=function(){this.$editorContainer=e('<div class="wangEditor-container"></div>')}}),c(function(f,e){f.fn.addTxt=function(){var a=this,g=new f.Txt(a);a.txt=g}}),c(function(f,e){f.fn.addMenuContainer=function(){var a=this;a.menuContainer=new f.MenuContainer(a)}}),c(function(f,e){f.createMenuFns=[],f.createMenu=function(a){f.createMenuFns.push(a)},f.fn.addMenus=function(){function g(h){return a.indexOf(h)>=0?!0:!1}var b=this,a=b.config.menus;e.each(f.createMenuFns,function(i,h){h.call(b,g)})}}),c(function(f,e){f.createMenu(function(a){var j="bold";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.bold,commandName:"Bold"});g.clickEventSelected=function(l){var k=i.isRangeEmpty();k?i.commandForElem("b,strong,h1,h2,h3,h4,h5",l,"Bold"):i.command(l,"Bold")},i.menus[j]=g}})}),c(function(f,e){f.createMenu(function(a){var j="underline";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.underline,commandName:"Underline"});g.clickEventSelected=function(l){var k=i.isRangeEmpty();k?i.commandForElem("u,a",l,"Underline"):i.command(l,"Underline")},i.menus[j]=g}})}),c(function(f,e){f.createMenu(function(a){var j="italic";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.italic,commandName:"Italic"});g.clickEventSelected=function(l){var k=i.isRangeEmpty();k?i.commandForElem("i",l,"Italic"):i.command(l,"Italic")},i.menus[j]=g}})}),c(function(f,e){f.createMenu(function(n){var m="forecolor";if(n(m)){var l=this,k=l.config.lang,j=l.config.colors,b=new f.Menu({editor:l,id:m,title:k.forecolor}),a=e("<div></div>");e.each(j,function(h,g){a.append(['<a href="#" class="color-item"','    title="'+g+'" commandValue="'+h+'" ','    style="color: '+h+'" ','><i class="wangeditor-menu-img-pencil"></i></a>'].join(""))}),a.on("click","a[commandValue]",function(g){var i=e(this),h=i.attr("commandValue");b.selected&&l.isRangeEmpty()?l.commandForElem("font[color]",g,"forecolor",h):l.command(g,"forecolor",h)}),b.dropPanel=new f.DropPanel(l,b,{$content:a,width:125}),b.updateSelectedEvent=function(){var g=l.getRangeElem();return g=l.getSelfOrParentByName(g,"font[color]"),g?!0:!1},l.menus[m]=b}})}),c(function(f,e){f.createMenu(function(p){function o(h){var g;return h&&h.style&&null!=h.style.cssText&&(g=h.style.cssText,g&&g.indexOf("background-color:")>=0)?!0:!1}var n="bgcolor";if(p(n)){var m=this,l=m.config.lang,k=m.config.colors,b=new f.Menu({editor:m,id:n,title:l.bgcolor}),a=e("<div></div>");e.each(k,function(h,g){a.append(['<a href="#" class="color-item"','    title="'+g+'" commandValue="'+h+'" ','    style="color: '+h+'" ','><i class="wangeditor-menu-img-brush"></i></a>'].join(""))}),a.on("click","a[commandValue]",function(g){var i=e(this),h=i.attr("commandValue");b.selected&&m.isRangeEmpty()?m.commandForElem({selector:"span,font",check:o},g,"BackColor",h):m.command(g,"BackColor",h)}),b.dropPanel=new f.DropPanel(m,b,{$content:a,width:125}),b.updateSelectedEvent=function(){var g=m.getRangeElem();return g=m.getSelfOrParentByName(g,"span,font",o),g?!0:!1},m.menus[n]=b}})}),c(function(f,e){f.createMenu(function(a){var j="strikethrough";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.strikethrough,commandName:"StrikeThrough"});g.clickEventSelected=function(l){var k=i.isRangeEmpty();k?i.commandForElem("strike",l,"StrikeThrough"):i.command(l,"StrikeThrough")},i.menus[j]=g}})}),c(function(f,e){f.createMenu(function(j){var i="eraser";if(j(i)){var h=this,b=h.config.lang,a=new f.Menu({editor:h,id:i,title:b.eraser,commandName:"RemoveFormat"});a.clickEvent=function(k){function o(){var g,v,u,t,s,r,q,p=this;g=p.getRangeElem(),t=p.getSelfOrParentByName(g,"blockquote"),t&&(s=e(t),l=e("<p>"+s.text()+"</p>"),s.after(l).remove()),v=p.getSelfOrParentByName(g,"p,h1,h2,h3,h4,h5"),v&&(u=e(v),l=e("<p>"+u.text()+"</p>"),u.after(l).remove()),r=p.getSelfOrParentByName(g,"ul,ol"),r&&(q=e(r),l=e("<p>"+q.text()+"</p>"),q.after(l).remove())}function n(){var g=this;l&&g.restoreSelectionByElem(l.get(0))}var m=h.isRangeEmpty();if(!m){return void h.command(k,"RemoveFormat")}var l;h.customCommand(k,o,n)},h.menus[i]=a}})}),c(function(f,e){f.createMenu(function(n){function m(){var h=a.$codeTextarea,g=j.txt.$txt,i=h.val();j.config.jsFilter&&(i=i.replace(/<script[\s\S]*?<\/script>/gi,"")),g.html(i)}var l="source";if(n(l)){var k,j=this,b=j.config.lang,a=new f.Menu({editor:j,id:l,title:b.source});a.isShowCode=!1,a.clickEvent=function(i){var t=this,s=t.editor,r=s.txt.$txt,q=r.outerHeight(),p=r.height();t.$codeTextarea||(t.$codeTextarea=e('<textarea class="code-textarea"></textarea>'));var o=t.$codeTextarea;o.css({height:p,"margin-top":q-p}),o.val(r.html()),r.after(o).hide(),o.show(),a.isShowCode=!0,this.updateSelected(),s.disableMenusExcept("source"),k=r.html()},a.clickEventSelected=function(i){var h=this,q=h.editor,p=q.txt.$txt,o=h.$codeTextarea;o&&(m(),o.after(p).hide(),p.show(),a.isShowCode=!1,this.updateSelected(),q.enableMenusExcept("source"),p.html()!==k&&q.onchange&&"function"==typeof q.onchange&&q.onchange.call(q))},a.updateSelectedEvent=function(){return this.isShowCode},j.menus[l]=a}})}),c(function(f,e){f.createMenu(function(j){var i="quote";if(j(i)){var h=this,b=h.config.lang,a=new f.Menu({editor:h,id:i,title:b.quote,commandName:"formatBlock",commandValue:"blockquote"});a.clickEvent=function(k){function q(){m=e("<p>"+o.text()+"</p>"),o.after(m).remove(),m.wrap("<blockquote>")}function p(){var g=this;m&&g.restoreSelectionByElem(m.get(0))}var o,n=h.getRangeElem();if(!n){return void k.preventDefault()}var m,l=h.getSelfOrParentByName(n,"blockquote");return l?void k.preventDefault():(n=h.getLegalTags(n),o=e(n),o.text()?n?void h.customCommand(k,q,p):void h.command(k,"formatBlock","blockquote"):void 0)},a.clickEventSelected=function(k){function p(){var g,q;return g=e(m),q=g.children(),q.length?(q.each(function(s){var r=e(this);"P"===r.get(0).nodeName?g.after(r):g.after("<p>"+r.text()+"</p>"),l=r}),void g.remove()):void 0}function o(){var g=this;l&&g.restoreSelectionByElem(l.get(0))}var n,m,l;return n=h.getRangeElem(),(m=h.getSelfOrParentByName(n,"blockquote"))?void h.customCommand(k,p,o):void k.preventDefault()},a.updateSelectedEvent=function(){var k,g=this,l=g.editor;return k=l.getRangeElem(),k=l.getSelfOrParentByName(k,"blockquote"),k?!0:!1},h.menus[i]=a,h.ready(function(){var g=this,l=g.txt.$txt,k=!1;l.on("keydown",function(p){if(13!==p.keyCode){return void (k=!1)}var o=g.getRangeElem();if(o=g.getSelfOrParentByName(o,"blockquote"),!o){return void (k=!1)}if(!k){return void (k=!0)}var n=g.getRangeElem(),m=e(n);m.length&&m.parent().after(m),g.restoreSelectionByElem(n,"start"),k=!1,p.preventDefault()})}),h.ready(function(){function g(){m&&m.remove()}function n(){if(m){var o=m.prev();o.length?l.restoreSelectionByElem(o.get(0)):l.initSelection()}}var m,l=this,k=l.txt.$txt;k.on("keydown",function(q){if(8===q.keyCode){var p=l.getRangeElem();if(p=l.getSelfOrParentByName(p,"blockquote")){m=e(p);var o=m.text();o||l.customCommand(q,g,n)}}})})}})}),c(function(f,e){f.createMenu(function(p){var o="fontfamily";if(p(o)){var n=this,m=n.config.lang,l=n.config.familys,k=new f.Menu({editor:n,id:o,title:m.fontfamily,commandName:"fontName"}),b={};e.each(l,function(h,g){b[g]=g});var a='<span style="font-family:{#commandValue};">{#title}</span>';k.dropList=new f.DropList(n,k,{data:b,tpl:a,selectorForELemCommand:"font[face]"}),k.updateSelectedEvent=function(){var g=n.getRangeElem();return g=n.getSelfOrParentByName(g,"font[face]"),g?!0:!1},n.menus[o]=k}})}),c(function(f,e){f.createMenu(function(a){var p="fontsize";if(a(p)){var o=this,n=o.config.lang,m=o.config.fontsizes,l=new f.Menu({editor:o,id:p,title:n.fontsize,commandName:"fontSize"}),k=m,j='<span style="font-size:{#title};">{#title}</span>';l.dropList=new f.DropList(o,l,{data:k,tpl:j,selectorForELemCommand:"font[size]"}),l.updateSelectedEvent=function(){var b=o.getRangeElem();return b=o.getSelfOrParentByName(b,"font[size]"),b?!0:!1},o.menus[p]=l}})}),c(function(f,e){f.createMenu(function(t){function s(b){o.queryCommandState("InsertOrderedList")?(p=!0,o.command(b,"InsertOrderedList")):p=!1}function r(b){p&&o.command(b,"InsertOrderedList")}var q="head";if(t(q)){var p,o=this,n=o.config.lang,m=new f.Menu({editor:o,id:q,title:n.head,commandName:"formatBlock"}),l={"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"},a="{#commandValue}{#title}";m.dropList=new f.DropList(o,m,{data:l,tpl:a,beforeEvent:s,afterEvent:r}),m.updateSelectedEvent=function(){var b=o.getRangeElem();return b=o.getSelfOrParentByName(b,"h1,h2,h3,h4,h5"),b?!0:!1},o.menus[q]=m}})}),c(function(f,e){f.createMenu(function(a){var j="unorderlist";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.unorderlist,commandName:"InsertUnorderedList"});i.menus[j]=g}})}),c(function(f,e){f.createMenu(function(a){var j="orderlist";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.orderlist,commandName:"InsertOrderedList"});i.menus[j]=g}})}),c(function(f,e){f.createMenu(function(j){var i="alignleft";if(j(i)){var h=this,b=h.config.lang,a=new f.Menu({editor:h,id:i,title:b.alignleft,commandName:"JustifyLeft"});a.updateSelectedEvent=function(){var g=h.getRangeElem();return g=h.getSelfOrParentByName(g,"p,h1,h2,h3,h4,h5,li",function(k){var l;return k&&k.style&&null!=k.style.cssText&&(l=k.style.cssText,l&&/text-align:\s*left;/.test(l))?!0:"left"===e(k).attr("align")?!0:!1}),g?!0:!1},h.menus[i]=a}})}),c(function(f,e){f.createMenu(function(j){var i="aligncenter";if(j(i)){var h=this,b=h.config.lang,a=new f.Menu({editor:h,id:i,title:b.aligncenter,commandName:"JustifyCenter"});a.updateSelectedEvent=function(){var g=h.getRangeElem();return g=h.getSelfOrParentByName(g,"p,h1,h2,h3,h4,h5,li",function(k){var l;return k&&k.style&&null!=k.style.cssText&&(l=k.style.cssText,l&&/text-align:\s*center;/.test(l))?!0:"center"===e(k).attr("align")?!0:!1}),g?!0:!1},h.menus[i]=a}})}),c(function(f,e){f.createMenu(function(j){var i="alignright";if(j(i)){var h=this,b=h.config.lang,a=new f.Menu({editor:h,id:i,title:b.alignright,commandName:"JustifyRight"});a.updateSelectedEvent=function(){var g=h.getRangeElem();return g=h.getSelfOrParentByName(g,"p,h1,h2,h3,h4,h5,li",function(k){var l;return k&&k.style&&null!=k.style.cssText&&(l=k.style.cssText,l&&/text-align:\s*right;/.test(l))?!0:"right"===e(k).attr("align")?!0:!1}),g?!0:!1},h.menus[i]=a}})}),c(function(f,e){f.createMenu(function(z){var y="link";if(z(y)){var x=this,w=x.config.lang,v=new f.Menu({editor:x,id:y,title:w.link}),u=e("<div></div>"),t=e('<div style="margin:20px 10px;" class="clearfix"></div>'),s=t.clone(),r=t.clone().css("margin","0 10px"),q=e('<input type="text" class="block" placeholder="'+w.text+'"/>'),p=e('<input type="text" class="block" placeholder="'+w.link+'"/>'),b=e('<button class="right">'+w.submit+"</button>"),a=e('<button class="right gray">'+w.cancel+"</button>");t.append(q),s.append(p),r.append(b).append(a),u.append(t).append(s).append(r),v.dropPanel=new f.DropPanel(x,v,{$content:u,width:300}),v.clickEvent=function(j){var i=this,o=i.dropPanel;if(o.isShowing){return void o.hide()}q.val(""),p.val("");var n="",m=x.getRangeElem();m=x.getSelfOrParentByName(m,"a"),m&&(n=m.href||"");var l="",k=x.isRangeEmpty();k?m&&(l=m.textContent||m.innerHTML):l=x.getRangeText()||"",n&&p.val(n),l&&q.val(l),k?q.removeAttr("disabled"):q.attr("disabled",!0),o.show()},v.updateSelectedEvent=function(){var g=x.getRangeElem();return g=x.getSelfOrParentByName(g,"a"),g?!0:!1},a.click(function(g){g.preventDefault(),v.dropPanel.hide()}),b.click(function(I){I.preventDefault();var H,G,F,E,D,C,B=x.getRangeElem(),A=x.getSelfOrParentByName(B,"a"),m=x.isRangeEmpty(),l=x.txt.$txt,g="link"+f.random(),K=e.trim(p.val()),J=e.trim(q.val());return K?(J||(J=K),void (m?A?(H=e(A),F=function(){H.attr("href",K),H.text(J)},E=function(){var h=this;h.restoreSelectionByElem(A)},x.customCommand(I,F,E)):(G='<a href="'+K+'" target="_blank">'+J+"</a>",f.userAgent.indexOf("Firefox")>0&&(G+="<span>&nbsp;</span>"),x.command(I,"insertHtml",G)):(D=l.find("a"),D.attr(g,"1"),x.command(I,"createLink",K),C=l.find("a").not("["+g+"]"),C.attr("target","_blank"),D.removeAttr(g)))):void v.dropPanel.focusFirstInput()}),x.menus[y]=v}})}),c(function(f,e){f.createMenu(function(j){var i="unlink";if(j(i)){var h=this,b=h.config.lang,a=new f.Menu({editor:h,id:i,title:b.unlink,commandName:"unLink"});a.clickEvent=function(k){function r(){m.after(l).remove()}function q(){h.restoreSelectionByElem(l.get(0))}var p=h.isRangeEmpty();if(!p){return void h.command(k,"unLink")}var o=h.getRangeElem(),n=h.getSelfOrParentByName(o,"a");if(!n){return void k.preventDefault()}var m=e(n),l=e("<span>"+m.text()+"</span>");h.customCommand(k,r,q)},h.menus[i]=a}})}),c(function(f,e){f.createMenu(function(B){var A="table";if(B(A)){var z,y,x,w=this,v=w.config.lang,u=new f.Menu({editor:w,id:A,title:v.table}),t=e('<div style="font-size: 14px; color: #666; text-align:right;"></div>'),s=e('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">'),r=e("<span>0</span>"),q=e("<span> 行 </span>"),b=e("<span>0</span>"),a=e("<span> 列</span>");for(y=0;15>y;y++){for(z=e('<tr index="'+(y+1)+'">'),x=0;20>x;x++){z.append(e('<td index="'+(x+1)+'">'))}s.append(z)}t.append(s),t.append(r).append(q).append(b).append(a),s.on("mouseenter","td",function(g){var k=e(g.currentTarget),j=k.attr("index"),i=k.parent(),h=i.attr("index");r.text(h),b.text(j),s.find("tr").each(function(){var l=e(this),m=l.attr("index");parseInt(m,10)<=parseInt(h,10)?l.find("td").each(function(){var n=e(this),o=n.attr("index");parseInt(o,10)<=parseInt(j,10)?n.addClass("active"):n.removeClass("active")}):l.find("td").removeClass("active")})}).on("mouseleave",function(g){s.find("td").removeClass("active"),r.text(0),b.text(0)}),s.on("click","td",function(G){var F,E,D=e(G.currentTarget),C=D.attr("index"),p=D.parent(),o=p.attr("index"),n=parseInt(o,10),m=parseInt(C,10),h="<table>";for(F=0;n>F;F++){for(h+="<tr>",E=0;m>E;E++){h+="<td><span>&nbsp;</span></td>"}h+="</tr>"}h+="</table>",w.command(G,"insertHtml",h)}),u.dropPanel=new f.DropPanel(w,u,{$content:t,width:262}),w.menus[A]=u}})}),c(function(f,e){f.createMenu(function(x){function w(g,h){e.each(g,function(j,A){var z=A.icon||A.url,y=A.value||A.title,n="icon"===q?z:y,m=e('<a href="#" commandValue="'+n+'"></a>'),l=e("<img>");l.attr("_src",z),m.append(l),h.append(m),u.emotionUrls.push(z)})}var v="emotion";if(x(v)){var u=this,t=u.config,s=t.lang,r=t.emotions,q=t.emotionsShow;u.emotionUrls=[];var p=new f.Menu({editor:u,id:v,title:s.emotion}),o=e('<div class="panel-tab"></div>'),b=e('<div class="tab-container"></div>'),a=e('<div class="content-container emotion-content-container"></div>');e.each(r,function(y,n){var m=n.title,l=n.data;f.log("正在处理 "+m+" 表情的数据...");var k=e('<a href="#">'+m+" </a>");b.append(k);var j=e('<div class="content"></div>');if(a.append(j),k.click(function(g){b.children().removeClass("selected"),a.children().removeClass("selected"),j.addClass("selected"),k.addClass("selected"),g.preventDefault()}),"string"==typeof l){f.log("将通过 "+l+" 地址ajax下载表情包"),e.get(l,function(g){g=e.parseJSON(g),f.log("下载完毕，得到 "+g.length+" 个表情"),w(g,j)})}else{if(!(Object.prototype.toString.call(l).toLowerCase().indexOf("array")>0)){return void f.error("data 数据格式错误，请修改为正确格式，参考文档："+f.docsite)}w(l,j)}}),o.append(b).append(a),b.children().first().addClass("selected"),a.children().first().addClass("selected"),a.on("click","a[commandValue]",function(g){var j=e(g.currentTarget),i=j.attr("commandValue"),h=document.createElement("img");h.onload=function(){u.command(g,"InsertImage",i),h=null},h.onerror=function(){u.command(g,"insertHtml","<span>"+i+"</span>"),h=null},h.src=i,g.preventDefault()}),p.dropPanel=new f.DropPanel(u,p,{$content:o,width:350}),p.clickEvent=function(i){var h=this,g=h.dropPanel;return g.isShowing?void g.hide():(g.show(),void (h.imgLoaded||(a.find("img").each(function(){var k=e(this),j=k.attr("_src");k.on("error",function(){f.error("加载不出表情图片 "+j)}),k.attr("src",j),k.removeAttr("_src")}),h.imgLoaded=!0)))},u.menus[v]=p}})}),c(function(f,e){function g(r,q,p){function o(){l.val("")}var n=r.config.lang,m=e('<div style="margin:20px 10px 10px 10px;"></div>'),l=e('<input type="text" class="block" placeholder="http://"/>');m.append(l);var k=e('<button class="right">'+n.submit+"</button>"),b=e('<button class="right gray">'+n.cancel+"</button>");p.append(m).append(k).append(b),b.click(function(h){h.preventDefault(),q.dropPanel.hide()}),k.click(function(i){i.preventDefault();var h=e.trim(l.val());if(!h){return void l.focus()}var a='<img style="max-width:100%;" src="'+h+'"/>';r.command(i,"insertHtml",a,o)})}f.createMenu(function(C){function B(){s.click(function(h){u.children().removeClass("selected"),t.children().removeClass("selected"),b.addClass("selected"),s.addClass("selected"),h.preventDefault()}),r.click(function(h){u.children().removeClass("selected"),t.children().removeClass("selected"),a.addClass("selected"),r.addClass("selected"),h.preventDefault(),f.placeholder&&a.find("input[type=text]").focus()}),s.click()}function A(){u.remove(),b.remove(),a.addClass("selected")}var z="img";if(C(z)){var y=this,x=y.config.lang,w=new f.Menu({editor:y,id:z,title:x.img}),v=e('<div class="panel-tab"></div>'),u=e('<div class="tab-container"></div>'),t=e('<div class="content-container"></div>');v.append(u).append(t);var s=e('<a href="#">上传图片</a>'),r=e('<a href="#">网络图片</a>');u.append(s).append(r);var b=e('<div class="content"></div>');t.append(b);var a=e('<div class="content"></div>');t.append(a),g(y,w,a),w.dropPanel=new f.DropPanel(y,w,{$content:v,width:400,onRender:function(){var h=y.config.customUploadInit;h&&h.call(y)}}),y.menus[z]=w,y.ready(function(){function i(){w.dropPanel.hide()}var h=this,l=h.config,k=l.uploadImgUrl,j=l.customUpload;k||j?(h.$uploadContent=b,B()):A(),b.click(function(){setTimeout(i)})})}})}),c(function(f,e){f.createMenu(function(F){var E="video";if(F(E)){var D=this,C=D.config.lang,B=/^<(iframe)|(embed)/i,A=new f.Menu({editor:D,id:E,title:C.video}),z=e("<div></div>"),y=e('<div style="margin:20px 10px;"></div>'),x=e('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');y.append(x);var w=e('<div style="margin:20px 10px;"></div>'),v=e('<input type="text" value="640" style="width:50px;text-align:center;"/>'),u=e('<input type="text" value="498" style="width:50px;text-align:center;"/>');w.append("<span> "+C.width+" </span>").append(v).append("<span> px &nbsp;&nbsp;&nbsp;</span>").append("<span> "+C.height+" </span>").append(u).append("<span> px </span>");var t=e("<div></div>"),s=e('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>'),b=e('<button class="right">'+C.submit+"</button>"),a=e('<button class="right gray">'+C.cancel+"</button>");t.append(s).append(b).append(a),z.append(y).append(w).append(t),a.click(function(g){g.preventDefault(),x.val(""),A.dropPanel.hide()}),b.click(function(h){h.preventDefault();var p,o=e.trim(x.val()),n=parseInt(v.val()),m=parseInt(u.val()),k=e("<div>"),g='<p style="text-align:center;">{content}</p>';return o?B.test(o)?isNaN(n)||isNaN(m)?void alert("宽度或高度不是数字！"):(p=e(o),p.attr("width",n).attr("height",m),g=g.replace("{content}",k.append(p).html()),D.command(h,"insertHtml",g),void x.val("")):(alert("视频链接格式错误！"),void A.dropPanel.focusFirstInput()):void A.dropPanel.focusFirstInput()}),A.dropPanel=new f.DropPanel(D,A,{$content:z,width:400}),D.menus[E]=A}})}),c(function(f,e){var h=function(b){return"onkeyup" in b}(document.createElement("input"));f.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas";var g=1;f.createMenu(function(T){function S(){G.val("")}var R="location";if(T(R)){if(g++>1){return void f.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单")}var Q=this,P=Q.config,O=P.lang,N=P.mapAk;Q.mapData={};var M=Q.mapData;M.markers=[],M.mapContainerId="map"+f.random(),M.clearLocations=function(){var i=M.map;i&&(i.clearOverlays(),M.markers=[])},M.searchMap=function(){var j=M.map;if(j){var i,n,m=window.BMap,l=H.val(),k=G.val();""!==l&&(k&&""!==k||j.centerAndZoom(l,11),k&&""!==k&&(i=new m.Geocoder,i.getPoint(k,function(o){o?(j.centerAndZoom(o,13),n=new m.Marker(o),j.addOverlay(n),n.enableDragging(),M.markers.push(n)):j.centerAndZoom(l,11)},l)))}};var L=!1;window.baiduMapCallBack=function(){function i(m){var p=m.name;k.setCenter(p),H.val(p),f.placeholder&&G.focus();var o,n;h?(n=function(q){"keyup"===q.type&&13===q.keyCode&&q.preventDefault(),o&&clearTimeout(o),o=setTimeout(M.searchMap,500)},H.on("keyup change paste",n),G.on("keyup change paste",n)):(n=function(){if(!J.is(":visible")){return void clearTimeout(o)}var r="",q="",t=H.val(),s=G.val();(t!==r||s!==q)&&(M.searchMap(),r=t,q=s),o&&clearTimeout(o),o=setTimeout(n,1000)},o=setTimeout(n,1000))}if(!L){L=!0;var l=window.BMap;M.map||(M.map=new l.Map(M.mapContainerId));var k=M.map;k.centerAndZoom(new l.Point(116.404,39.915),11),k.addControl(new l.MapTypeControl),k.setCurrentCity("北京"),k.enableScrollWheelZoom(!0);var j=new l.LocalCity;j.get(i),k.addEventListener("click",function(n){var m=new l.Marker(new l.Point(n.point.lng,n.point.lat));k.addOverlay(m),m.enableDragging(),M.markers.push(m)},!1)}},M.loadMapScript=function(){var i=document.createElement("script");i.type="text/javascript",i.src="http://api.map.baidu.com/api?v=2.0&ak="+N+"&callback=baiduMapCallBack";try{document.body.appendChild(i)}catch(j){f.error("加载地图过程中发生错误")}},M.initMap=function(){window.BMap?window.baiduMapCallBack():M.loadMapScript()};var K=new f.Menu({editor:Q,id:R,title:O.location});Q.menus[R]=K;var J=e("<div></div>"),I=e('<div style="margin:10px 0;"></div>'),H=e('<input type="text"/>');H.css({width:"80px","text-align":"center"});var G=e('<input type="text"/>');G.css({width:"300px","margin-left":"10px"}).attr("placeholder",O.searchlocation);var F=e('<button class="right link">'+O.clearLocation+"</button>");I.append(F).append(H).append(G),J.append(I),F.click(function(i){G.val(""),G.focus(),M.clearLocations(),i.preventDefault()});var E=e('<div id="'+M.mapContainerId+'"></div>');E.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});var D=e("<span>"+O.loading+"</span>");D.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"}),E.append(D),J.append(E);var C=e('<div style="margin:10px 0;"></div>'),B=e('<button class="right">'+O.submit+"</button>"),A=e('<button class="right gray">'+O.cancel+"</button>"),b=e('<label style="display:inline-block;margin-top:10px;color:#666;"></label>'),a=e('<input type="checkbox">');b.append(a).append('<span style="display:inline-block;margin-left:5px;">  '+O.dynamicMap+"</span>"),C.append(b).append(B).append(A),J.append(C),A.click(function(i){i.preventDefault(),S(),K.dropPanel.hide()}),B.click(function(X){X.preventDefault();var W,V,U,z=M.map,y=a.is(":checked"),x=M.markers,w=z.getCenter(),v=w.lng,u=w.lat,t=z.getZoom(),l=z.getSize(),j=l.width,Y=l.height;if(V=y?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",V=V+"center="+v+","+u+"&zoom="+t+"&width="+j+"&height="+Y,x.length>0&&(V+="&markers=",e.each(x,function(k,i){W=i.getPosition(),k>0&&(V+="|"),V=V+W.lng+","+W.lat})),y){if(x.length>1){return void alert(O.langDynamicOneLocation)}V+="&markerStyles=l,A",U='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+j+'" height="'+Y+'"></iframe>',U=U.replace("{src}",V),Q.command(X,"insertHtml",U,S)}else{Q.command(X,"insertHtml",'<img style="max-width:100%;" src="'+V+'"/>',S)}}),K.dropPanel=new f.DropPanel(Q,K,{$content:J,width:500}),K.onRender=function(){N===f.baiduMapAk&&f.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+f.docsite)},K.clickEvent=function(j){var i=this,l=i.dropPanel,k=!1;return l.isShowing?void l.hide():(M.map||(k=!0),M.initMap(),l.show(),void (k||G.focus()))}}})}),c(function(f,e){function g(){if(!(f.userAgent.indexOf("MSIE 8")>0)){var a=document.createElement("script");a.type="text/javascript",a.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js",document.body.appendChild(a)}}f.createMenu(function(w){function v(h){var m=e("<div></div>");m.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"}),b.css({width:"100%",height:"100%",padding:"10px"}),b.on("keydown",function(n){9===n.keyCode&&n.preventDefault()}),m.append(b),h.append(m);var l=e("<div></div>"),k=e('<button class="right">'+r.submit+"</button>"),j=e('<button class="right gray">'+r.cancel+"</button>");l.append(k).append(j).append(a),h.append(l),j.click(function(n){n.preventDefault(),p.dropPanel.hide()});var i='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';k.click(function(G){function F(){var H;B&&(H=x.attr("class"),H!==B+" hljs"&&x.attr("class",B+" hljs")),x.html(D)}function E(){s.restoreSelectionByElem(n),z()}G.preventDefault();var D=b.val();if(!D){return void b.focus()}var C=s.getRangeElem();e.trim(e(C).text())&&(i="<p><br></p>"+i);var B=a?a.val():"",A="",z=function(){e("pre code").each(function(I,H){window.hljs&&window.hljs.highlightBlock(H)})};if(B&&(A=' class="'+B+' hljs"'),D=D.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;"),!p.selected){var y=i.replace("{#langClass}",A).replace("{#content}",D);return void s.command(G,"insertHtml",y,z)}var x,n=s.getSelfOrParentByName(C,"pre");n&&(n=s.getSelfOrParentByName(C,"code")),n&&(x=e(n),s.customCommand(G,F,E))})}function u(){var i=s.getRangeElem(),h=s.getSelfOrParentByName(i,"code");h?s.disableMenusExcept("insertcode"):s.enableMenusExcept("insertcode")}var t="insertcode";if(w(t)){setTimeout(g,0);var s=this,r=s.config.lang,q=s.txt.$txt,p=new f.Menu({editor:s,id:t,title:r.insertcode});p.clickEvent=function(h){var k=this,j=k.dropPanel;if(j.isShowing){return void j.hide()}b.val(""),j.show();var i=window.hljs;i&&i.listLanguages?(a.css({"margin-top":"9px","margin-left":"5px"}),e.each(i.listLanguages(),function(m,l){a.append('<option value="'+l+'">'+l+"</option>")})):a.hide()},p.clickEventSelected=function(h){var x=this,n=x.dropPanel;if(n.isShowing){return void n.hide()}n.show();var m,l,k=s.getRangeElem(),j=s.getSelfOrParentByName(k,"pre");j&&(j=s.getSelfOrParentByName(k,"code")),j&&(m=e(j),b.val(m.text()),a&&(l=m.attr("class"),l&&a.val(l.split(" ")[0])))},p.updateSelectedEvent=function(){var i,h=this,j=h.editor;return i=j.getRangeElem(),i=j.getSelfOrParentByName(i,"pre"),i?!0:!1};var o=e("<div></div>"),b=e("<textarea></textarea>"),a=e("<select></select>");v(o),p.dropPanel=new f.DropPanel(s,p,{$content:o,width:500}),s.menus[t]=p,q.on("keydown",function(i){if(13===i.keyCode){var h=s.getRangeElem(),j=s.getSelfOrParentByName(h,"code");j&&s.command(i,"insertHtml","\n")}}),q.on("keydown click",function(h){setTimeout(u)})}})}),c(function(f,e){f.createMenu(function(a){var j="undo";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.undo});g.clickEvent=function(b){i.undo()},i.menus[j]=g,i.ready(function(){function l(){n.undoRecord()}var k,n=this,m=n.txt.$txt;m.on("keydown",function(o){var b=o.keyCode;return o.ctrlKey&&90===b?void n.undo():void (13===b?l():(k&&clearTimeout(k),k=setTimeout(l,1000)))}),n.undoRecord()})}})}),c(function(f,e){f.createMenu(function(a){var j="redo";if(a(j)){var i=this,h=i.config.lang,g=new f.Menu({editor:i,id:j,title:h.redo});g.clickEvent=function(b){i.redo()},i.menus[j]=g}})}),c(function(f,e){var g;f.createMenu(function(w){var v="fullscreen";if(w(v)){var u,t,s=this,r=s.txt.$txt,q=s.config,p=q.zindex||10000,o=q.lang,n=!1,a=new f.Menu({editor:s,id:v,title:o.fullscreen});a.clickEvent=function(j){var y=s.$editorContainer;y.addClass("wangEditor-fullscreen"),u=y.css("z-index"),y.css("z-index",p);var x,l=r.height(),h=r.outerHeight();s.useMaxHeight&&(t=r.css("max-height"),r.css("max-height","none"),x=r.parent(),x.after(r),x.remove(),r.css("overflow-y","auto"));var z=s.menuContainer;r.height(f.$window.height()-z.height()-(h-l)),s.menuContainer.$menuContainer.attr("style",""),n=!0,s.isFullScreen=!0,g=f.$window.scrollTop()},a.clickEventSelected=function(h){var i=s.$editorContainer;i.removeClass("wangEditor-fullscreen"),i.css("z-index",u),s.useMaxHeight?r.css("max-height",t):s.$valueContainer.css("height",s.valueContainerHeight),s.txt.initHeight(),n=!1,s.isFullScreen=!1,null!=g&&f.$window.scrollTop(g)},a.updateSelectedEvent=function(b){return n},s.menus[v]=a}})}),c(function(f,e){f.fn.renderMenus=function(){var b,j=this,i=j.menus,h=j.config.menus,g=(j.menuContainer,0);e.each(h,function(a,k){return"|"===k?void g++:(b=i[k],void (b&&b.render(g)))})}}),c(function(f,e){f.fn.renderMenuContainer=function(){var h=this,g=h.menuContainer;h.$editorContainer;g.render()}}),c(function(f,e){f.fn.renderTxt=function(){var h=this,g=h.txt;g.render(),h.ready(function(){g.initHeight()})}}),c(function(f,e){f.fn.renderEditorContainer=function(){var h,g,l=this,k=l.$valueContainer,j=l.$editorContainer,i=l.txt.$txt;k===i?(h=l.$prev,g=l.$parent,h&&h.length?h.after(j):g.prepend(j)):(k.after(j),k.hide())}}),c(function(f,e){f.fn.eventMenus=function(){var b=this.menus;e.each(b,function(h,g){g.bindEvent()})}}),c(function(f,e){f.fn.eventMenuContainer=function(){}}),c(function(f,e){f.fn.eventTxt=function(){var b=this.txt;b.saveSelectionEvent(),b.updateValueEvent(),b.updateMenuStyleEvent()}}),c(function(f,e){f.plugin(function(){var a=this,g=a.config.uploadImgFns;g.onload||(g.onload=function(h,k){f.log("上传结束，返回结果为 "+h);var j,i=this;0===h.indexOf("error|")?(f.warn("上传失败："+h.split("|")[1]),alert(h.split("|")[1])):(f.log("上传成功，即将插入编辑区域，结果为："+h),j=document.createElement("img"),j.onload=function(){var b='<img src="'+h+'" style="max-width:100%;"/>';i.command(null,"insertHtml",b),f.log("已插入图片，地址 "+h),j=null},j.onerror=function(){f.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+h),j=null},j.src=h)}),g.ontimeout||(g.ontimeout=function(h){f.error("上传上图片发生错误"),alert("上传上图片发生错误")}),g.onerror||(g.onerror=function(h){f.error("上传图片超时"),alert("上传图片超时")})})}),c(function(f,e){window.FileReader&&window.FormData&&f.plugin(function(){function v(h,g){var l,k=window.atob(h.split(",")[1]),j=new ArrayBuffer(k.length),i=new Uint8Array(j);for(l=0;l<k.length;l++){i[l]=k.charCodeAt(l)}return new Blob([j],{type:g})}function u(g,i){var h=document.createElement("img");h.onload=function(){var j='<img src="'+g+'" style="max-width:100%;"/>';s.command(i,"insertHtml",j),f.log("已插入图片，地址 "+g),h=null},h.onerror=function(){f.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+g),h=null},h.src=g}function t(h){if(h.lengthComputable){var g=h.loaded/h.total;s.showUploadProgress(100*g)}}var s=this,r=s.config,q=r.uploadImgUrl,p=r.uploadTimeout,o=r.uploadImgFns,n=o.onload,b=o.ontimeout,a=o.onerror;q&&(s.xhrUploadImg=function(B){function A(){E&&clearTimeout(E),D&&D.abort&&D.abort(),m.preventDefault(),H&&H.call(s,D),s.hideUploadProgress()}var m=B.event,l=B.filename||"",k=B.base64,i=B.fileType||"image/png",h=B.name||"wangEditor_upload_file",J=B.loadfn||n,I=B.errorfn||a,H=B.timeoutfn||b,G=s.config.uploadParams||{},F="png";if(l.indexOf(".")>0?F=l.slice(l.lastIndexOf(".")-l.length+1):i.indexOf("/")>0&&i.split("/")[1]&&(F=i.split("/")[1]),f.isOnWebsite){return f.log("预览模拟上传"),void u(k,m)}var E,D=new XMLHttpRequest,C=new FormData;D.onload=function(){E&&clearTimeout(E),J&&J.call(s,D.responseText,D),s.hideUploadProgress()},D.onerror=function(){E&&clearTimeout(E),m.preventDefault(),I&&I.call(s,D),s.hideUploadProgress()},D.upload.onprogress=t,C.append(h,v(k,i),f.random()+"."+F),e.each(G,function(j,g){C.append(j,g)}),D.open("POST",q,!0),D.send(C),E=setTimeout(A,p),f.log("开始上传...并开始超时计算")})})}),c(function(f,e){f.plugin(function(){function t(){l||(l=!0,m.css({top:p+"px"}),o.append(m))}function s(){m.hide(),b=null}var r=this,q=r.menuContainer,p=q.height(),o=r.$editorContainer,n=o.width(),m=e('<div class="wangEditor-upload-progress"></div>'),l=!1;r.showUploadProgress=function(a){b&&clearTimeout(b),t(),m.show(),m.width(a*n/100)};var b;r.hideUploadProgress=function(g){b&&clearTimeout(b),g=g||750,b=setTimeout(s,g)}})}),c(function(f,e){f.plugin(function(){var p,o=this,n=o.config,m=n.uploadImgUrl,l=n.uploadTimeout;if(m){var k=o.$uploadContent;if(k){var b=e('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');k.append(b);var a=new f.UploadFile({editor:o,uploadUrl:m,timeout:l,fileAccept:"image/*"});b.click(function(g){p=g,a.selectFiles()})}}})}),c(function(f,e){if(window.FileReader&&window.FormData){var g=function(b){this.editor=b.editor,this.uploadUrl=b.uploadUrl,this.timeout=b.timeout,this.fileAccept=b.fileAccept,this.multiple=!0};g.fn=g.prototype,g.fn.clear=function(){this.$input.val(""),f.log("input value 已清空")},g.fn.render=function(){var n=this;if(!n._hasRender){f.log("渲染dom");var m=n.fileAccept,l=m?'accept="'+m+'"':"",k=n.multiple,j=k?'multiple="multiple"':"",b=e('<input type="file" '+l+" "+j+"/>"),a=e('<div style="visibility:hidden;"></div>');a.append(b),f.$body.append(a),b.on("change",function(h){n.selected(h,b.get(0))}),n.$input=b,n._hasRender=!0}},g.fn.selectFiles=function(){var a=this;f.log("使用 html5 方式上传"),a.render(),f.log("选择文件"),a.$input.click()},g.fn.selected=function(i,h){var b=this,a=h.files||[];0!==a.length&&(f.log("选中 "+a.length+" 个文件"),e.each(a,function(k,j){b.upload(j)}))},g.fn.upload=function(x){function w(){v.clear()}var v=this,u=v.editor,t=x.name||"",s=x.type||"",r=u.config.uploadImgFns,q=u.config.uploadImgFileName||"wangEditorH5File",p=r.onload,o=r.ontimeout,n=r.onerror,a=new FileReader;return p&&o&&n?(f.log("开始执行 "+t+" 文件的上传"),a.onload=function(h){f.log("已读取"+t+"文件");var i=h.target.result||this.result;u.xhrUploadImg({event:h,filename:t,base64:i,fileType:s,name:q,loadfn:function(k,j){w();var l=this;p.call(l,k,j)},errorfn:function(j){w(),f.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生");var k=this;n.call(k,j)},timeoutfn:function(j){w(),f.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生");var k=this;o(k,j)}})},void a.readAsDataURL(x)):void f.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件")},f.UploadFile=g}}),c(function(f,e){if(!window.FileReader||!window.FormData){var g=function(b){this.editor=b.editor,this.uploadUrl=b.uploadUrl,this.timeout=b.timeout,this.fileAccept=b.fileAccept,this.multiple=!1};g.fn=g.prototype,g.fn.clear=function(){this.$input.val(""),f.log("input value 已清空")},g.fn.hideModal=function(){this.modal.hide()},g.fn.render=function(){var B=this,A=B.editor,z=A.config.uploadImgFileName||"wangEditorFormFile";if(!B._hasRender){var y=B.uploadUrl;f.log("渲染dom");var x="iframe"+f.random(),w=e('<iframe name="'+x+'" id="'+x+'" frameborder="0" width="0" height="0"></iframe>'),v=B.multiple,u=v?'multiple="multiple"':"",t=e("<p>选择图片并上传</p>"),s=e('<input type="file" '+u+' name="'+z+'"/>'),r=e('<input type="submit" value="上传"/>'),q=e('<form enctype="multipart/form-data" method="post" action="'+y+'" target="'+x+'"></form>'),b=e('<div style="margin:10px 20px;"></div>');q.append(t).append(s).append(r),e.each(A.config.uploadParams,function(h,i){q.append(e('<input type="hidden" name="'+h+'" value="'+i+'"/>'))}),b.append(q),b.append(w),B.$input=s,B.$iframe=w;var a=new f.Modal(A,void 0,{$content:b});B.modal=a,B._hasRender=!0}},g.fn.bindLoadEvent=function(){function b(){var h=e.trim(j.document.body.innerHTML);h&&(i.call(m,h),n.clear(),n.hideModal())}var n=this;if(!n._hasBindLoad){var m=n.editor,l=n.$iframe,k=l.get(0),j=k.contentWindow,i=m.config.uploadImgFns.onload;k.attachEvent?k.attachEvent("onload",b):k.onload=b,n._hasBindLoad=!0}},g.fn.show=function(){function i(){j.show(),h.bindLoadEvent()}var h=this,j=h.modal;setTimeout(i)},g.fn.selectFiles=function(){var a=this;f.log("使用 form 方式上传"),a.render(),a.clear(),a.show()},f.UploadFile=g}}),c(function(f,e){f.plugin(function(){function r(){var i=/^data:(image\/\w+);base64/,h=m.find("img");f.log("粘贴后，检查到编辑器有"+h.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片"),e.each(h,function(){var v,u,t=this,s=e(t),k=s.attr("src");p.each(function(){return t===this?(v=!0,!1):void 0}),v||(f.log("找到一个粘贴过来的图片"),i.test(k)?(f.log("src 是 base64 格式，可以上传"),u=k.match(i)[1],o.xhrUploadImg({event:q,base64:k,fileType:u,name:a})):f.log("src 为 "+k+" ，不是 base64 格式，暂时不支持上传"),s.remove())}),f.log("遍历结束")}var q,p,o=this,n=o.txt,m=n.$txt,l=o.config,b=l.uploadImgUrl,a=l.uploadImgFileName||"wangEditorPasteFile";b&&m.on("paste",function(t){q=t;var s,k,h=q.clipboardData||q.originalEvent.clipboardData;s=null==h?window.clipboardData&&window.clipboardData.getData("text"):h.getData("text/plain")||h.getData("text/html"),s||(k=h&&h.items,k?(f.log("通过 data.items 得到了数据"),e.each(k,function(i,w){var v=w.type||"";if(!(v.indexOf("image")<0)){var u=w.getAsFile(),j=new FileReader;f.log("得到一个粘贴图片"),j.onload=function(g){f.log("读取到粘贴的图片");var x=g.target.result||this.result;o.xhrUploadImg({event:q,base64:x,fileType:v,name:a})},j.readAsDataURL(u)}})):(f.log("未从 data.items 得到数据，使用检测粘贴图片的方式"),p=m.find("img"),f.log("粘贴前，检查到编辑器有"+p.length+"个图片"),setTimeout(r,0)))})})}),c(function(f,e){f.plugin(function(){var l=this,k=l.txt,j=k.$txt,i=l.config,b=i.uploadImgUrl,a=i.uploadImgFileName||"wangEditorDragFile";b&&(f.$document.on("dragleave drop dragenter dragover",function(g){g.preventDefault()}),j.on("drop",function(m){m.preventDefault();var h=m.originalEvent,g=h.dataTransfer&&h.dataTransfer.files;g&&g.length&&e.each(g,function(n,r){var q=r.type,p=r.name;if(!(q.indexOf("image/")<0)){f.log("得到图片 "+p);var o=new FileReader;o.onload=function(s){f.log("读取到图片 "+p);var t=s.target.result||this.result;l.xhrUploadImg({event:m,base64:t,fileType:q,name:a})},o.readAsDataURL(r)}})}))})}),c(function(f,e){f.plugin(function(){function D(){u||(C(),t.append(s).append(r).append(b).append(a),y.$editorContainer.append(t),u=!0)}function C(){function h(i,j){g&&y.customCommand(i,g,j)}var g;r.click(function(i){g=function(){z.remove()},h(i,function(){setTimeout(A,100)})}),a.click(function(i){g=function(){z.css({width:"100%"})},h(i,function(){setTimeout(B)})}),b.click(function(i){g=function(){z.css({width:"auto"})},h(i,function(){setTimeout(B)})})}function B(){if(!y._disabled&&null!=z){z.addClass("clicked");var I=z.position(),H=I.top,G=I.left,F=z.outerHeight(),E=z.outerWidth(),q=H+F,n=G,m=0,k=v.position().top,h=v.outerHeight();q>k+h&&(q=k+h),t.show();var g=t.outerWidth();m=E/2-g/2,t.css({top:q+5,left:n,"margin-left":m}),0>m?(t.css("margin-left","0"),s.hide()):s.show()}}function A(){null!=z&&(z.removeClass("clicked"),z=null,t.hide())}var z,y=this,x=y.txt,w=x.$txt,v=y.useMaxHeight?w.parent():w,u=!1,t=e('<div class="txt-toolbar"></div>'),s=e('<div class="tip-triangle"></div>'),r=e('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),b=e('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),a=e('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');v.on("click","table",function(g){var h=e(g.currentTarget);return D(),z&&z.get(0)===h.get(0)?void setTimeout(A,100):(z=h,B(),g.preventDefault(),void g.stopPropagation())}).on("click keypress scroll",function(g){setTimeout(A,100)}),f.$body.on("click keypress scroll",function(g){setTimeout(A,100)})})}),c(function(f,e){f.userAgent.indexOf("MSIE 8")>0||f.plugin(function(){function al(i,o){if(ae){var n,m,l=function(){null!=o&&(Y=o)},k=!1,j=ae.parent();if("a"===j.get(0).nodeName.toLowerCase()?(m=j,k=!0):m=e('<a target="_blank"></a>'),null==o){return m.attr("href")||""}if(""===o){k&&(n=function(){ae.unwrap()})}else{if(o===Y){return}n=function(){m.attr("href",o),k||ae.wrap(m)}}n&&ad.customCommand(i,n,l)}}function ak(){W||(aj(),ai(),O.append(M).append(K).append(I).append(b).append(a).append(X).append(V).append(T),R.append(P).append(L).append(N),S.append(Q).append(O).append(R),ad.$editorContainer.append(S).append(U),W=!0)}function aj(){function g(j,i){h&&ad.customCommand(j,h,i)}var h;M.click(function(i){al(i,""),h=function(){ae.remove()},g(i,function(){setTimeout(ag,100)})}),I.click(function(i){h=function(){var k=ae.get(0),j=k.width,l=k.height;j=1.1*j,l=1.1*l,ae.css({width:j+"px",height:l+"px"})},g(i,function(){setTimeout(ah)})}),K.click(function(i){h=function(){var k=ae.get(0),j=k.width,l=k.height;j=0.9*j,l=0.9*l,ae.css({width:j+"px",height:l+"px"})},g(i,function(){setTimeout(ah)})}),b.click(function(i){h=function(){ae.parent().css({"text-align":"left"}).attr("align","left")},g(i,function(){setTimeout(ag,100)})}),X.click(function(i){h=function(){ae.parent().css({"text-align":"right"}).attr("align","right")},g(i,function(){setTimeout(ag,100)})}),a.click(function(i){h=function(){ae.parent().css({"text-align":"center"}).attr("align","center")},g(i,function(){setTimeout(ag,100)})}),V.click(function(i){i.preventDefault(),Y=al(i),P.val(Y),O.hide(),R.show()}),N.click(function(i){i.preventDefault();var j=e.trim(P.val());j&&al(i,j),setTimeout(ag)}),L.click(function(i){i.preventDefault(),P.val(Y),O.show(),R.hide()}),T.click(function(i){i.preventDefault(),al(i,""),setTimeout(ag)})}function ai(){function h(q){var i,s;i=q.pageX-o,s=q.pageY-n;var r=m+i,p=l+s;U.css({"margin-left":r,"margin-top":p});var g=k+i,t=j+s;ae&&ae.css({width:g,height:t})}var o,n,m,l,k,j;U.on("mousedown",function(g){ae&&(o=g.pageX,n=g.pageY,m=parseFloat(U.css("margin-left"),10),l=parseFloat(U.css("margin-top"),10),k=ae.width(),j=ae.height(),S.hide(),f.$document.on("mousemove._dragResizeImg",h),f.$document.on("mouseup._dragResizeImg",function(i){f.$document.off("mousemove._dragResizeImg"),f.$document.off("mouseup._dragResizeImg"),ag(),U.css({"margin-left":m,"margin-top":l}),J=!1}),J=!0)})}function ah(){if(!ad._disabled&&null!=ae){ae.addClass("clicked");var v=ae.position(),u=v.top,t=v.left,s=ae.outerHeight(),r=ae.outerWidth();U.css({top:u+s,left:t+r});var q=u+s,p=t,o=0,n=Z.position().top,k=Z.outerHeight();q>n+k?q=n+k:U.show(),S.show();var j=S.outerWidth();o=r/2-j/2,S.css({top:q+5,left:p,"margin-left":o}),0>o?(S.css("margin-left","0"),Q.hide()):Q.show(),ad.disableMenusExcept()}}function ag(){null!=ae&&(ae.removeClass("clicked"),ae=null,S.hide(),U.hide(),ad.enableMenusExcept())}function af(g){var h=!1;return ad.emotionUrls?(e.each(ad.emotionUrls,function(i,k){var j=!1;return g===k&&(h=!0,j=!0),j?!1:void 0}),h):h}var ae,ad=this,ac=ad.config.lang,ab=ad.txt,aa=ab.$txt,Z=ad.useMaxHeight?aa.parent():aa,Y=(ad.$editorContainer,""),W=!1,U=e('<div class="img-drag-point"></div>'),S=e('<div class="txt-toolbar"></div>'),Q=e('<div class="tip-triangle"></div>'),O=e("<div></div>"),M=e('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),K=e('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),I=e('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>'),b=e('<a href="#"><i class="wangeditor-menu-img-align-left"></i></a>'),a=e('<a href="#"><i class="wangeditor-menu-img-align-center"></i></a>'),X=e('<a href="#"><i class="wangeditor-menu-img-align-right"></i></a>'),V=e('<a href="#"><i class="wangeditor-menu-img-link"></i></a>'),T=e('<a href="#"><i class="wangeditor-menu-img-unlink"></i></a>'),R=e('<div style="display:none;"></div>'),P=e('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>'),N=e('<button class="right">'+ac.submit+"</button>"),L=e('<button class="right gray">'+ac.cancel+"</button>"),J=!1;Z.on("mousedown","img",function(g){g.preventDefault()}).on("click","img",function(g){var i=e(g.currentTarget),h=i.attr("src");if(h&&!af(h)){if(ak(),ae&&ae.get(0)===i.get(0)){return void setTimeout(ag,100)}ae=i,ah(),O.show(),R.hide(),g.preventDefault(),g.stopPropagation()}}).on("click keypress scroll",function(g){J||setTimeout(ag,100)})})}),c(function(f,e){f.plugin(function(){function F(){A||(t.append(s).append(r),w.$editorContainer.append(t),A=!0)}function E(){if(B){var h=B.position(),g=h.left,j=h.top,i=B.height();t.css({top:j+i+5,left:g})}}function D(){if(!b&&B){F(),t.show();var a=B.attr("href");r.attr("href",a),E(),b=!0}}function C(){b&&B&&(t.hide(),b=!1)}var B,A,z,y,x,w=this,v=w.config.lang,u=w.txt.$txt,t=e('<div class="txt-toolbar"></div>'),s=e('<div class="tip-triangle"></div>'),r=e('<a href="#" target="_blank"><i class="wangeditor-menu-img-link"></i> '+v.openLink+"</a>"),b=!1;u.on("mouseenter","a",function(g){z&&clearTimeout(z),z=setTimeout(function(){var a=g.currentTarget;B=e(a),D()},500)}).on("mouseleave","a",function(g){y&&clearTimeout(y),y=setTimeout(C,500)}).on("click keypress scroll",function(g){setTimeout(C,100)}),t.on("mouseenter",function(g){y&&clearTimeout(y)}).on("mouseleave",function(g){x&&clearTimeout(x),x=setTimeout(C,500)})})}),c(function(f,e){f.plugin(function(){var x=this,w=x.config.menuFixed;if(w!==!1&&"number"==typeof w){var v=parseFloat(f.$body.css("margin-top"),10);isNaN(v)&&(v=0);var u,t=x.$editorContainer,s=t.offset().top,r=t.outerHeight(),q=x.menuContainer.$menuContainer,p=q.css("position"),o=q.css("top"),n=q.outerHeight(),a=q.offset().top;x.txt.$txt;f.$window.scroll(function(){if(!x.isFullScreen){u=q.width();var b=f.$window.scrollTop();b>=a&&s+r>b+w+n+30?(q.css({position:"fixed",top:w}),q.width(u),f.$body.css({"margin-top":v+n}),x._isMenufixed||(x._isMenufixed=!0)):(q.css({position:p,top:o}),q.css("width","100%"),f.$body.css({"margin-top":v}),x._isMenufixed&&(x._isMenufixed=!1))}})}})}),c(function(f,e){f.createMenu(function(h){var g="indent";if(h(g)){var b=this,a=new f.Menu({editor:b,id:g,title:"缩进",$domNormal:e('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:e('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});a.clickEvent=function(i){function m(){l.css("text-indent","2em")}var l,k=b.getRangeElem(),j=b.getSelfOrParentByName(k,"p");return j?(l=e(j),void b.customCommand(i,m)):i.preventDefault()},a.clickEventSelected=function(i){function m(){l.css("text-indent","0")}var l,k=b.getRangeElem(),j=b.getSelfOrParentByName(k,"p");return j?(l=e(j),void b.customCommand(i,m)):i.preventDefault()},a.updateSelectedEvent=function(){var i,l,k=b.getRangeElem(),j=b.getSelfOrParentByName(k,"p");return j?(i=e(j),l=i.css("text-indent"),l&&"0px"!==l?!0:!1):!1},b.menus[g]=a}})}),c(function(f,e){f.createMenu(function(l){var k="lineheight";if(l(k)){var j=this;j.commandHooks.lineHeight=function(g){var m=j.getRangeElem(),h=j.getSelfOrParentByName(m,"p,h1,h2,h3,h4,h5,pre");h&&e(h).css("line-height",g+"")};var i=new f.Menu({editor:j,id:k,title:"行高",commandName:"lineHeight",$domNormal:e('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:e('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')}),b={"1.0":"1.0倍",1.5:"1.5倍",1.8:"1.8倍","2.0":"2.0倍",2.5:"2.5倍","3.0":"3.0倍"},a='<span style="line-height:{#commandValue}">{#title}</span>';i.dropList=new f.DropList(j,i,{data:b,tpl:a}),j.menus[k]=i}})}),c(function(f,e){f.plugin(function(){var l=this,k=l.config.customUpload;if(k){if(l.config.uploadImgUrl){return alert("自定义上传无效，详看浏览器日志console.log"),void f.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。")}var j=l.$uploadContent;j||f.error("自定义上传，无法获取 editor.$uploadContent");var i=e('<a href="#" class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></a>');j.append(i);var b="upload"+f.random(),a="upload"+f.random();i.attr("id",b),j.attr("id",a),l.customUploadBtnId=b,l.customUploadContainerId=a}})}),c(function(f,e){f.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")}),window.wangEditor});